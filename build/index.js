!function o(s,a,h){function u(e,t){if(!a[e]){if(!s[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(l)return l(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var n=a[e]={exports:{}};s[e][0].call(n.exports,function(t){return u(s[e][1][t]||t)},n,n.exports,o,s,a,h)}return a[e].exports}for(var l="function"==typeof require&&require,t=0;t<h.length;t++)u(h[t]);return u}({1:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],2:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],3:[function(t,e,f){var a=/%[sdj%]/g;f.format=function(t){if(!b(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(h(arguments[i]));return e.join(" ")}i=1;for(var r=arguments,n=r.length,o=String(t).replace(a,function(t){if("%%"===t)return"%";if(n<=i)return t;switch(t){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(t){return"[Circular]"}default:return t}}),s=r[i];i<n;s=r[++i])_(s)||!u(s)?o+=" "+s:o+=" "+h(s);return o},f.deprecate=function(t,e){if(w(global.process))return function(){return f.deprecate(t,e).apply(this,arguments)};if(!0===process.noDeprecation)return t;var i=!1;return function(){if(!i){if(process.throwDeprecation)throw new Error(e);process.traceDeprecation?console.trace(e):console.error(e),i=!0}return t.apply(this,arguments)}};var r,n={};function h(t,e){var i={seen:[],stylize:s};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),m(e)?i.showHidden=e:e&&f._extend(i,e),w(i.showHidden)&&(i.showHidden=!1),w(i.depth)&&(i.depth=2),w(i.colors)&&(i.colors=!1),w(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=o),d(i,t,i.depth)}function o(t,e){var i=h.styles[e];return i?"["+h.colors[i][0]+"m"+t+"["+h.colors[i][1]+"m":t}function s(t,e){return t}function d(e,i,r){if(e.customInspect&&i&&k(i.inspect)&&i.inspect!==f.inspect&&(!i.constructor||i.constructor.prototype!==i)){var t=i.inspect(r,e);return b(t)||(t=d(e,t,r)),t}var n=function(t,e){if(w(e))return t.stylize("undefined","undefined");if(b(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(x(e))return t.stylize(""+e,"number");if(m(e))return t.stylize(""+e,"boolean");if(_(e))return t.stylize("null","null")}(e,i);if(n)return n;var o,s=Object.keys(i),a=(o={},s.forEach(function(t,e){o[t]=!0}),o);if(e.showHidden&&(s=Object.getOwnPropertyNames(i)),A(i)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return g(i);if(0===s.length){if(k(i)){var h=i.name?": "+i.name:"";return e.stylize("[Function"+h+"]","special")}if(S(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(T(i))return e.stylize(Date.prototype.toString.call(i),"date");if(A(i))return g(i)}var u,l="",c=!1,p=["{","}"];y(i)&&(c=!0,p=["[","]"]),k(i)&&(l=" [Function"+(i.name?": "+i.name:"")+"]");return S(i)&&(l=" "+RegExp.prototype.toString.call(i)),T(i)&&(l=" "+Date.prototype.toUTCString.call(i)),A(i)&&(l=" "+g(i)),0!==s.length||c&&0!=i.length?r<0?S(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),u=c?function(e,i,r,n,t){for(var o=[],s=0,a=i.length;s<a;++s)R(i,String(s))?o.push(v(e,i,r,n,String(s),!0)):o.push("");return t.forEach(function(t){t.match(/^\d+$/)||o.push(v(e,i,r,n,t,!0))}),o}(e,i,r,a,s):s.map(function(t){return v(e,i,r,a,t,c)}),e.seen.pop(),function(t,e,i){if(60<t.reduce(function(t,e){return 0<=e.indexOf("\n")&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0))return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(u,l,p)):p[0]+l+p[1]}function g(t){return"["+Error.prototype.toString.call(t)+"]"}function v(t,e,i,r,n,o){var s,a,h;if((h=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?a=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(a=t.stylize("[Setter]","special")),R(r,n)||(s="["+n+"]"),a||(t.seen.indexOf(h.value)<0?-1<(a=_(i)?d(t,h.value,null):d(t,h.value,i-1)).indexOf("\n")&&(a=o?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),w(s)){if(o&&n.match(/^\d+$/))return a;s=(s=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(s,"string"))}return s+": "+a}function y(t){return Array.isArray(t)}function m(t){return"boolean"==typeof t}function _(t){return null===t}function x(t){return"number"==typeof t}function b(t){return"string"==typeof t}function w(t){return void 0===t}function S(t){return u(t)&&"[object RegExp]"===i(t)}function u(t){return"object"==typeof t&&null!==t}function T(t){return u(t)&&"[object Date]"===i(t)}function A(t){return u(t)&&("[object Error]"===i(t)||t instanceof Error)}function k(t){return"function"==typeof t}function i(t){return Object.prototype.toString.call(t)}function l(t){return t<10?"0"+t.toString(10):t.toString(10)}f.debuglog=function(e){if(w(r)&&(r=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!n[e])if(new RegExp("\\b"+e+"\\b","i").test(r)){var i=process.pid;n[e]=function(){var t=f.format.apply(f,arguments);console.error("%s %d: %s",e,i,t)}}else n[e]=function(){};return n[e]},(f.inspect=h).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},h.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},f.isArray=y,f.isBoolean=m,f.isNull=_,f.isNullOrUndefined=function(t){return null==t},f.isNumber=x,f.isString=b,f.isSymbol=function(t){return"symbol"==typeof t},f.isUndefined=w,f.isRegExp=S,f.isObject=u,f.isDate=T,f.isError=A,f.isFunction=k,f.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},f.isBuffer=t("./support/isBuffer");var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function R(t,e){return Object.prototype.hasOwnProperty.call(t,e)}f.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[l(t.getHours()),l(t.getMinutes()),l(t.getSeconds())].join(":"),[t.getDate(),c[t.getMonth()],e].join(" ")),f.format.apply(f,arguments))},f.inherits=t("inherits"),f._extend=function(t,e){if(!e||!u(e))return t;for(var i=Object.keys(e),r=i.length;r--;)t[i[r]]=e[i[r]];return t}},{"./support/isBuffer":2,inherits:1}],4:[function(t,e,i){"use strict";function r(t){this.id=t,this.volume=1,this.muted=!0,this.loopSound=null,this.loopId=null,this.loopVol=0,this.nextLoop=null}(e.exports=r).prototype.setVolume=function(t,e){var i=this.muted;this.muted=0===t||e||!1,null!=t?this.volume=t:t=this.volume,this.loopId&&(this.loopSound&&this.muted?this.loopSound.stop():this.loopSound&&this.loopSound.id===this.loopId?(this.loopSound.setVolume(Math.max(0,Math.min(1,t*this.loopVol))),i&&this.loopSound.play()):this.muted||this.audioManager.playLoopSound(this.id,this.loopId,this.loopVol))},r.prototype.setMute=function(t){this.setVolume(null,t)},r.prototype.playLoopSound=function(t,i,r,n,o,s){var a=this.audioManager,h=a.settings.defaultFade,e=a.settings.crossFading,u=this.loopSound,l=u&&u.id;if(i=Math.max(0,Math.min(1,i||1)),this.loopId=t,this.loopVol=i,!a.muted&&!this.muted){if(t===l&&u)return u.play(i*this.volume,r,n),void(this.nextLoop&&(this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=null));if(u=null,!this.nextLoop||this.nextLoop.id!==t){var c=this;e?(this.nextLoop&&this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=a.createSound(t,this.id),this.nextLoop.load(function(t){if(t)return c.nextLoop.unload(),void(c.nextLoop=null);p(c.loopSound),d()})):(this.nextLoop=a.createSound(t,this.id),p(this.loopSound,d))}}function p(t,e){if(!t)return e&&e();t.stopping||t.stop(function(){return a.freeSound(t),t=null,e&&e()})}function f(){var e=c.loopSound=c.nextLoop;c.nextLoop=null,e&&(e.setLoop(!0,o,s),e.fade=h,e.load(function(t){if(t)return e.unload(),void(c.loopSound=null);e.play(i*c.volume,r,n)}))}function d(){c.loopSound=null,window.setTimeout(f,0)}}},{}],5:[function(t,e,i){"use strict";var r=window.AudioContext||window.webkitAudioContext,n=t("./OrderedList"),o=t("./SoundBuffered.js"),s=t("./SoundGroup.js"),a=t("./AudioChannel.js"),h=t("./ISound.js");function u(t){this.soundsById={},this.soundGroupsById={},this.permanentSounds={},this.freeSoundPool=[],this.soundArchive=new n(function(){return 1}),this.soundGroupArchive=new n(function(){return 1}),this.soundArchiveById={},this.soundGroupArchiveById={},this.usedMemory=0,this.channels={},this.audioContext=null,this.muted=!1,this.settings={audioPath:"",maxSoundGroup:500,maxUsedMemory:300,defaultFade:2,maxPlayLatency:1e3,crossFading:!1,getFileUri:function(t,e){return t+e+".mp3"},getSoundConstructor:function(){return null}};for(var e=0;e<t.length;e++){var i=t[e];this.channels[i]=new a(i)}h.prototype.audioManager=this,s.prototype.audioManager=this,a.prototype.audioManager=this}r||(console.warn("Web Audio API is not supported on this platform. Fallback to regular HTML5 <Audio>"),o=t("./Sound.js"),window.Audio||(console.warn("HTML5 <Audio> is not supported on this platform. Sound features are unavailable."),o=h)),e.exports=u,e.exports.ISound=h,u.prototype.init=function(){if(!this.audioContext&&r)for(var t in this.audioContext=new r,o.prototype.audioContext=this.audioContext,this.soundsById)this.soundsById[t].init()},u.prototype.getEmptySound=function(t,e){var i,r=this.settings.getSoundConstructor(t,e);return r?i=new r:(0<this.freeSoundPool.length?(i=this.freeSoundPool.pop()).init():i=new o,i)},u.prototype.setup=function(t){for(var e in t){var i=t[e];this.setVolume(e,i.volume,i.muted)}},u.prototype.addChannel=function(t){this.channels[t]||(this.channels[t]=new a(t))},u.prototype.setVolume=function(t,e,i){var r=this.channels[t];r&&r.setVolume(e,i)},u.prototype.setMute=function(t){for(var e in void 0===t&&(t=!this.muted),this.muted=!!t,this.channels){var i=this.channels[e];if(i.loopSound)if(t)i.loopSound.stop();else{var r=i.muted;i.muted=!0,i.setVolume(null,r)}}},u.prototype.loadSound=function(t,e){var i=this.createSound(t);return i.load(e),i},u.prototype.createSound=function(t,e){var i=this.getSound(t);return i||((i=this.soundsById[t]=this.getEmptySound(e,t)).setId(t),i)},u.prototype.createSoundPermanent=function(t,e){var i=this.getSound(t);if(i)return i;var r=this.settings.getSoundConstructor(e,t)||o;return(i=this.permanentSounds[t]=new r).setId(t),i},u.prototype.getSound=function(t){var e=this.permanentSounds[t];return e||((e=this.soundsById[t])?e:(e=this.soundArchiveById[t])?(this.soundArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundArchiveById[t],this.soundsById[t]=e):null)},u.prototype.getSoundGroup=function(t){var e=this.soundGroupsById[t];return e||((e=this.soundGroupArchiveById[t])?(this.soundGroupArchive.removeByRef(e.poolRef),e.poolRef=null,delete this.soundGroupArchiveById[t],e.verifySounds(),this.soundGroupsById[t]=e):null)},u.prototype.freeSound=function(t){var e=t.id;this.soundsById[e]&&delete this.soundsById[e],this.soundArchiveById[e]&&(this.soundArchive.removeByRef(t.poolRef),t.poolRef=null,delete this.soundArchiveById[e]),t.unload(),t instanceof o&&this.freeSoundPool.push(t)},u.prototype.playLoopSound=function(t,e,i,r,n,o,s){var a=this.channels[t];if(!a)return console.warn('Channel id "'+t+'" does not exist.');a.playLoopSound(e,i,r,n,o,s)},u.prototype.stopLoopSound=function(t){var e=this,i=this.channels[t];if(!i)return console.warn('Channel id "'+t+'" does not exist.');var r=i.loopSound;i.loopId=null,r&&r.stop(function(){e.freeSound(r),i.loopSound=null})},u.prototype.stopAllLoopSounds=function(){for(var t in this.channels)this.stopLoopSound(t)},u.prototype.release=function(){var t,e,i,r=this.settings.maxSoundGroup,n=this.settings.maxUsedMemory,o={};for(t in this.channels){var s=this.channels[t];s.loopSound&&(o[s.loopSound.id]=!0)}for(t in this.soundGroupsById)(e=this.soundGroupsById[t]).poolRef=this.soundGroupArchive.add(e),this.soundGroupArchiveById[t]=e,delete this.soundGroupsById[t];for(t in this.soundsById)o[t]||((i=this.soundsById[t]).poolRef=this.soundArchive.add(i),this.soundArchiveById[t]=i,delete this.soundsById[t]);for(var a=this.soundGroupArchive.getCount();r<a&&(e=this.soundGroupArchive.popFirst());)e.poolRef=null,delete this.soundGroupArchiveById[e.id],--a;for(;this.usedMemory>n&&(i=this.soundArchive.popFirst());)i.poolRef=null,delete this.soundArchiveById[i.id],this.freeSound(i)},u.prototype.playSound=function(t,e,i,r,n){if(!this.muted){var o=this.channels[t];if(!o.muted){var s=this.getSound(e);i=i||1,(s=s||this.createSound(e,t)).play(o.volume*i,r,n)}}},u.prototype.playSoundGroup=function(t,e,i,r,n){if(!this.muted){var o=this.channels[t];if(o&&!o.muted){var s=this.getSoundGroup(e);if(!s)return console.warn('SoundGroup "'+e+'" does not exist.');i=i||1,s.play(i*o.volume,r,n)}}},u.prototype.createSoundGroup=function(t,e,i){if(!this.getSoundGroup(t)){var r=new s(t,e.id,e.vol,e.pitch,i);this.soundGroupsById[t]=r}},u.prototype.createSoundGroups=function(t,e){var i=void 0!==e&&this.channels[e].muted;for(var r in t)this.createSoundGroup(r,t[r],i)}},{"./AudioChannel.js":4,"./ISound.js":6,"./OrderedList":7,"./Sound.js":8,"./SoundBuffered.js":9,"./SoundGroup.js":10}],6:[function(t,e,i){"use strict";function r(){this.playing=!1,this.stopping=!1,this.fade=0,this.usedMemory=0,this.poolRef=null,this.id=null,this.volume=1,this.pan=0,this.loop=!1,this.pitch=0,this._loaded=!1,this._loading=!1,this._unloading=!1,this._playTriggered=0,this._onLoadQueuedCallback=[]}(e.exports=r).prototype.setId=function(t){this.id=t,this._loaded=!1},r.prototype.load=function(t){return this.id?this._loaded?t&&t(null,this):(t&&this._onLoadQueuedCallback.push(t),this._loading?void 0:(this._loading=!0,this._load())):t&&t("noId")},r.prototype._finalizeLoad=function(t){var e=this.audioManager.settings.maxPlayLatency;this._loaded=!t,this._loading=!1;for(var i=0;i<this._onLoadQueuedCallback.length;i++)this._onLoadQueuedCallback[i](t,this);if(this._onLoadQueuedCallback=[],this._unloading)return this._unloading=!1,void this.unload();this._loaded&&this._playTriggered&&((this.loop||Date.now()-this._playTriggered<e)&&this._play(),this._playTriggered=0)},r.prototype.cancelOnLoadCallbacks=function(){this._onLoadQueuedCallback=[]},r.prototype.play=function(t,e,i){if(null!=t&&this.setVolume(t),null!=e&&this.setPan(e),!this._loaded)return this._playTriggered=Date.now(),void this.load();this.loop&&this.playing?this._updatePlayPitch(i):this._play(i)},r.prototype.init=function(){},r.prototype.setVolume=function(t){this.volume=t},r.prototype.setPan=function(t){this.pan=t},r.prototype.setLoop=function(t){this.loop=t},r.prototype.setPitch=function(t){this.pitch=t},r.prototype._updatePlayPitch=function(t){},r.prototype._play=function(t){this.playing=!0,console.log('ISound play call: "'+this.id+'"')},r.prototype.stop=function(t){return this.playing=!1,t&&t()},r.prototype._load=function(){return console.log("ISound load call: "+this.id),this._finalizeLoad(null)},r.prototype.unload=function(){return this._playTriggered=0,this.setLoop(!1),this.fade=0,this.pitch=0,this.stop(),this._loading?!(this._unloading=!0):(this.audioManager.usedMemory-=this.usedMemory,this.setVolume(1),this.setPan(0),this.id=null,this._loaded=!1,!(this.usedMemory=0))}},{}],7:[function(t,e,i){"use strict";function o(t,e,i,r){this.object=t,this.previous=e,this.next=i,this.container=r}function r(t){this.count=0,this.first=null,this.last=null,this.cmpFunc=t}r.prototype.add=function(t){var e=new o(t,null,null,this);if(this.count+=1,null===this.first)return this.first=e,this.last=e;var i=this.cmpFunc(t,this.first.object);if(i<0)return e.next=this.first,this.first.previous=e,this.first=e;var r,n=this.cmpFunc(t,this.last.object);if(0<=n)return e.previous=this.last,this.last.next=e,this.last=e;if(i+n<0){for(r=this.first.next;0<=this.cmpFunc(t,r.object);)r=r.next;e.next=r,e.previous=r.previous,e.previous.next=e,r.previous=e}else{for(r=this.last.previous;this.cmpFunc(t,r.object)<0;)r=r.previous;e.previous=r,e.next=r.next,e.next.previous=e,r.next=e}return e},r.prototype.removeByRef=function(t){return!(!t||t.container!==this)&&(--this.count,null===t.previous?this.first=t.next:t.previous.next=t.next,null===t.next?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=null,!(t.container=null))},r.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t),!0)},r.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t),!0)},r.prototype.possess=function(t){return t&&t.container===this},r.prototype.popFirst=function(){var t=this.first;if(!t)return null;--this.count;var e=t.object;return this.first=t.next,null!==this.first&&(this.first.previous=null),t.next=null,t.container=null,e},r.prototype.popLast=function(){var t=this.last;if(!t)return null;--this.count;var e=t.object;return this.last=t.previous,null!==this.last&&(this.last.next=null),t.previous=null,t.container=null,e},r.prototype.getFirst=function(){return this.first&&this.first.object},r.prototype.getLast=function(){return this.last&&this.last.object},r.prototype.clear=function(){for(var t=this.first;t;t=t.next)t.container=null;this.count=0,this.first=null,this.last=null},r.prototype.getCount=function(){return this.count},r.prototype.forEach=function(t,e){for(var i=this.first;i;i=i.next)t(i.object,e)},r.prototype.forEachReverse=function(t,e){for(var i=this.last;i;i=i.previous)t(i.object,e)},r.prototype.reposition=function(t){if(t.container!==this)return this.add(t.object);var e=t.previous,i=t.next,r=t.object;for(null===i?this.last=e:i.previous=e,null===e?this.first=i:e.next=i;null!==e&&this.cmpFunc(r,e.object)<0;)e=(i=e).previous;for(;null!==i&&0<=this.cmpFunc(r,i.object);)i=(e=i).next;return null===(t.next=i)?this.last=t:i.previous=t,null===(t.previous=e)?this.first=t:e.next=t,t},e.exports=r},{}],8:[function(t,e,i){"use strict";var r=t("util").inherits,n=t("./ISound.js"),o={playAudioWhenScreenIsLocked:!1};function s(){n.call(this);var t=new Audio;t.loop=!1,t.type="audio/mpeg",this._audio=t,this.audioContext&&(this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination))}r(s,n),(e.exports=s).prototype.setVolume=function(t){this.volume=this._audio.volume=t},s.prototype.setLoop=function(t){this.loop=this._audio.loop=t},s.prototype._load=function(){var e=this;function i(t){e._finalizeLoad(t)}function r(){this.removeEventListener("canplaythrough",r),this.removeEventListener("error",n),e.usedMemory=this.duration,e.audioManager.usedMemory+=this.duration,e._finalizeLoad(null)}function n(t){this.removeEventListener("canplaythrough",r),this.removeEventListener("error",n),i(t)}function o(t){e._loading=!0,e._audio.addEventListener("canplaythrough",r),e._audio.addEventListener("error",n),e._audio.src=t,e._audio.load()}var t=this.audioManager.settings.getFileUri,s=this.audioManager.settings.audioPath;if(2<t.length)t(s,this.id,function(t,e){if(t)return i(t);o(e)});else try{var a=t(s,this.id);if(!a)return i("emptyUri");o(a)}catch(t){i(t)}},s.prototype.unload=function(){n.prototype.unload.call(this)&&(this._audio.volume=1,this._audio.src="",this._audio.load())},s.prototype._play=function(t){this._audio.volume=this.volume,this._audio.pause(),this._audio.currentTime=0,this._audio.play(o),this.playing=!0},s.prototype.stop=function(t){return this._audio.pause(),this._audio.currentTime=0,this._playTriggered=0,this.playing=!1,t&&t()}},{"./ISound.js":6,util:3}],9:[function(t,e,i){"use strict";var r=t("util").inherits,n=t("./ISound.js"),o=1e-6;function s(){n.call(this),this.buffer=null,this.source=null,this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._playPitch=0,this._fadeTimeout=null,this._onStopCallback=null,this._audioNodeReady=!1,this._loopStart=0,this._loopEnd=0,this.init()}r(s,n),(e.exports=s).prototype._createAudioNodes=function(){if(!this._audioNodeReady&&this.audioContext){var t,e=this.audioContext,i=e.createGain();t=e.createStereoPanner?e.createStereoPanner():e.createPanner(),i.connect(t),t.connect(e.destination),i.gain.value=0,this.sourceConnector=i,this.gain=i.gain,this.panNode=t,this._audioNodeReady=!0}},s.prototype._destroyAudioNodes=function(){if(this._audioNodeReady){var t=this.audioContext,e=this.panNode,i=this.sourceConnector;i.disconnect(e),e.disconnect(t.destination),this.source&&(this.source.disconnect(i),this.source.onended=null,this.source=null),this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._audioNodeReady=!1}},s.prototype.init=function(){if(this._createAudioNodes(),this.rawAudioData){var e=this,i=this.audioManager.settings.maxPlayLatency;this.audioContext.decodeAudioData(this.rawAudioData,function(t){e.buffer=t,e.usedMemory=t.duration,e.audioManager.usedMemory+=t.duration,e.rawAudioData=null,e._loaded&&e._playTriggered&&((e.loop||Date.now()-e._playTriggered<i)&&e._play(),e._playTriggered=0)},function(){console.error("decode audio failed for sound ",e.id)})}},s.prototype.setVolume=function(t){if(this.volume=t,this.playing)if(this.fade){t<=0&&(t=o);var e=this.audioContext.currentTime;this.gain.cancelScheduledValues(e),this.gain.setValueAtTime(this.gain.value||o,e),this.gain.linearRampToValueAtTime(t,e+this.fade)}else this.gain.value=t},s.prototype.setPan=function(t){this.pan=t,this.panNode&&(this.panNode.pan?this.panNode.pan.value=t:this.panNode.setPosition(t,0,.2))},s.prototype.setLoop=function(t,e,i){this.loop=!!t,this._loopStart=e||0,this._loopEnd=i||0,this.source&&this.buffer&&(this.source.loop=t,this._setLoopPoints())},s.prototype._setLoopPoints=function(){this.source.loopStart=this._loopStart||0;var t=this._loopEnd;t<0&&(t=this.buffer.duration+t),t<0&&(t=0),this.source.loopEnd=t||this.buffer.duration},s.prototype.setPitch=function(t,e){this.pitch=t,this._setPlaybackRate(e)},s.prototype._updatePlayPitch=function(t){!t&&0!==t||t===this._playPitch||(this._playPitch=t,this._setPlaybackRate(0))},s.prototype._setPlaybackRate=function(t){if(this.source){var e=Math.pow(2,(this._playPitch+this.pitch)/12);if(t){var i=this.audioContext.currentTime;this.source.playbackRate.cancelScheduledValues(i),this.source.playbackRate.setValueAtTime(this.source.playbackRate.value||o,i),this.source.playbackRate.linearRampToValueAtTime(e,i+t)}else this.source.playbackRate.value=e}},s.prototype._load=function(){var i=this;function r(t){i._finalizeLoad(t)}function n(t){i.buffer=t,i.usedMemory=t.duration,i.audioManager.usedMemory+=t.duration,i._finalizeLoad(null)}function o(t){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=function(){if(4==~~e.readyState)return 200!=~~e.status&&0!=~~e.status?r("xhrError:"+e.status):void(i.audioContext?i.audioContext.decodeAudioData(e.response,n,r):(i.rawAudioData=e.response,i._finalizeLoad(null)))},e.open("GET",t,!0),e.send()}this._createAudioNodes();var t=this.audioManager.settings.getFileUri,e=this.audioManager.settings.audioPath;if(2<t.length)t(e,this.id,function(t,e){if(t)return r(t);o(e)});else try{var s=t(e,this.id);if(!s)return r("emptyUri");o(s)}catch(t){r(t)}},s.prototype.unload=function(){n.prototype.unload.call(this)&&(this._fadeTimeout&&(this._onStopCallback=null,this._stopAndClear()),this.buffer=null,this.source&&(this.source.onended=null,this.source.stop(0),this.source=null),this._destroyAudioNodes())},s.prototype._play=function(t){if(this.buffer){this.playing=!0;var e=this.audioContext.currentTime;if(this.gain.cancelScheduledValues(e),this.fade?(this.gain.setValueAtTime(this.gain.value||o,e),this.gain.linearRampToValueAtTime(this.volume||o,e+this.fade)):this.gain.value=this.volume,this._fadeTimeout)return this._onStopCallback=null,this.source.onended=null,this.stopping=!1,window.clearTimeout(this._fadeTimeout),void(this._fadeTimeout=null);this.source&&(this.source.disconnect(this.sourceConnector),this.source.onended=null);var i=this.source=this.audioContext.createBufferSource();i.connect(this.sourceConnector);var r=this;i.onended=function(){r.playing=!1,i.onended=null,r.source=null},this._playPitch=t||0,(t||this.pitch)&&this._setPlaybackRate(0),i.loop=this.loop,i.buffer=this.buffer,this._setLoopPoints(),i.start(0)}else this._playTriggered=Date.now()},s.prototype._stopAndClear=function(){this.stopping=!1,this.source.onended=null,this.source.stop(0),this.source=null,this._fadeTimeout&&(window.clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this._onStopCallback&&(this._onStopCallback(),this._onStopCallback=null)},s.prototype.stop=function(t){if(!this.playing&&!this.stopping)return t&&t();if(this._playTriggered=0,this.stopping=!0,this.playing=!1,!this.source)return t&&t();if(this._onStopCallback=t,!this._fadeTimeout){if(this.fade){var e=this,i=this.audioContext.currentTime;return this.gain.cancelScheduledValues(i),this.gain.setValueAtTime(this.gain.value||o,i),this.gain.linearRampToValueAtTime(o,i+this.fade),void(this._fadeTimeout=window.setTimeout(function(){e._fadeTimeout=null,e._stopAndClear()},1e3*this.fade))}this._stopAndClear()}}},{"./ISound.js":6,util:3}],10:[function(t,e,i){"use strict";function r(t,e,i,r,n){this.id=t,this.soundIds=e,this.volumes=i||[],this.pitches=r||[],this.soundIndex=0,this.volIndex=0,this.pitchIndex=0,this.poolRef=null,this._ready=!1,0===this.volumes.length&&this.volumes.push(1),0===this.pitches.length&&this.pitches.push(0),n||this._createSounds()}(e.exports=r).prototype._createSounds=function(){for(var t=this.soundIds,e=0;e<t.length;e++)this.audioManager.loadSound(t[e]);this._ready=!0},r.prototype.play=function(t,e,i){if(0!==this.soundIds.length){this._ready||this._createSounds();var r=this.soundIds[this.soundIndex++],n=this.audioManager.getSound(r);if(!n)return console.warn("[Sound Group: "+this.id+"] sound id "+r+"  cannot be played.");t=t||1,i=i||0,t*=this.volumes[this.volIndex++],i+=this.pitches[this.pitchIndex++],n.play(t,e,i),this.soundIndex>=this.soundIds.length&&(this.soundIndex=0),this.volIndex>=this.volumes.length&&(this.volIndex=0),this.pitchIndex>=this.pitches.length&&(this.pitchIndex=0)}},r.prototype.verifySounds=function(){for(var t=0;t<this.soundIds.length;t++){var e=this.soundIds[t];this.audioManager.createSound(e)}}},{}],11:[function(t,e,i){"use strict";var s=/rgba?\(\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,?\s*([.0-9]+)?\s*\)/;function r(){this.r=0,this.g=0,this.b=0,this.a=void 0,this.string=""}(e.exports=r).prototype._setRGB=function(t,e,i){this.r=t,this.g=e,this.b=i},r.prototype.fromPixel=function(t,e){var i=t[e+0],r=t[e+1],n=t[e+2];return this.string="rgb("+i+","+r+","+n+")",this._setRGB(i,r,n),this},r.prototype.fromString=function(t){var e,i,r,n=(this.string=t).match(s);if(n)e=~~n[1],i=~~n[2],r=~~n[3],this._setRGB(e,i,r);else{var o="0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&");this._setRGB(o>>16,o>>8&255,255&o)}return this},r.prototype.fromRGB=function(t,e,i){return this._setRGB(t,e,i),this.string="rgb("+t+","+e+","+i+")",this},r.prototype.fromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.string=t.string,this}},{}],12:[function(t,e,i){"use strict";var h=t("../spritesheet/Sprite");function r(t,e,i){t._isNineSlice&&(t=t.asset);var r=(this.asset=t).path,n=0,o=0;if(t._isTileMap)throw new Error("TileMap cannot be used as NineSlice");var s=t.width,a=t.height;t._isSprite?(n=t.x,o=t.y,t=t.img):t._isTexture&&(t=t.canvas,r=""),this.w0=e,this.w1=s-1,this.w2=s-e-1,this.h0=i,this.h1=a-1,this.h2=a-i-1,this._a=new h(t,r,n,o,e,i),this._b=new h(t,r,n+e,o,1,i),this._c=new h(t,r,n+e+1,o,this.w2,i),this._d=new h(t,r,n,o+i,e,1),this._e=new h(t,r,n+e,o+i,1,1),this._f=new h(t,r,n+e+1,o+i,this.w2,1),this._g=new h(t,r,n,o+i+1,e,this.h2),this._h=new h(t,r,n+e,o+i+1,1,this.h2),this._i=new h(t,r,n+e+1,o+i+1,this.w2,this.h2),this._j=new h(t,r,n,o,e,a),this._k=new h(t,r,n+e,o,1,a),this._l=new h(t,r,n+e+1,o,this.w2,a),this._m=new h(t,r,n,o,s,i),this._n=new h(t,r,n,o+i,s,1),this._o=new h(t,r,n,o+i+1,s,this.h2)}(e.exports=r).prototype._isNineSlice=!0,r.prototype._draw=function(t,e,i,r,n){(r=Math.round(r))<0&&(e+=r,r=-r),(n=Math.round(n))<0&&(i+=n,n=-n);var o=this.w1+1,s=this.h1+1;if(r<=o&&n<=s)t.draw(this.asset,e,i);else{var a=e+this.w0,h=e+r-this.w2,u=i+this.h0,l=i+n-this.h2;if(n<=s)return t.draw(this._j,e,i),t.stretchDraw(this._k,a,i,r-this.w1,s),void t.draw(this._l,h,i);if(r<=o)return t.draw(this._m,e,i),t.stretchDraw(this._n,e,u,o,n-this.h1),void t.draw(this._o,e,l);t.draw(this._a,e,i),t.stretchDraw(this._b,a,i,r-this.w1,this.h0),t.draw(this._c,h,i),t.stretchDraw(this._d,e,u,this.w0,n-this.h1),t.stretchDraw(this._e,a,u,r-this.w1,n-this.h1),t.stretchDraw(this._f,h,u,this.w2,n-this.h1),t.draw(this._g,e,l),t.stretchDraw(this._h,a,l,r-this.w1,this.h2),t.draw(this._i,h,l)}},r.prototype.draw=function(t,e,i,r){this._draw($screen,t,e,i,r)}},{"../spritesheet/Sprite":26}],13:[function(t,e,i){"use strict";var s=t(".");function a(t){console.error('Could not find asset "'+t+'"')}function n(t,e,i){for(var r=t.split("/"),n=window.assets,o=r.pop();0<r.length;)if(!(n=n[r.shift()]))return void a(t);n[o]?n[o]=new s(n[o],e,i):a(t)}e.exports=function(t){if("Nine slices config"===t._type){var e=t.sprites;for(var i in e){var r=e[i];n(i,r.w,r.h)}}}},{".":12}],14:[function(t,e,i){"use strict";function r(t,e){this.width=t,this.height=e,this.camera={x:0,y:0},this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._init()}function n(t,e){t.ox=0,t.oy=0,e._isImageWrapper&&(e=e.asset),e._isSprite?(t.ox=e.x,t.oy=e.y,t.tilesheet=e.img):e._isMap?(e.texture||e._prepareTexture(),t.tilesheet=e.texture.canvas):e._isTexture?t.tilesheet=e.canvas:(e instanceof Image||e instanceof HTMLCanvasElement)&&(t.tilesheet=e)}(e.exports=r).prototype.palette=[{string:"#000000",r:0,g:0,b:0},{string:"#FFFFFF",r:1,g:1,b:1}],r.prototype.ox=0,r.prototype.oy=0,r.setTileSize=function(){},r.prototype.setPalette=function(t){r.prototype.palette=t},r.prototype.setGlobalTilesheet=function(t){n(r.prototype,t)},r.prototype.setTilesheet=function(t){if(t)return n(this,t),this;delete this.tilesheet},r.prototype.setCamera=function(t,e){return this.camera.x=t||0,this.camera.y=e||0,this}},{}],15:[function(t,e,i){"use strict";var u=t("../domUtils/createCanvas"),l=[0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845];e.exports=function(){var t=u(64,36),e=t.getContext("2d");e.fillStyle="#FFF";for(var i=0;i<l.length;i++)for(var r=l[i],n=i%16,o=~~(i/16),s=0;s<15;s++){var a=s%3,h=~~(s/3);1==(r>>s&1)&&e.fillRect(4*n+a,6*o+h,1,1)}return t}},{"../domUtils/createCanvas":22}],16:[function(t,e,i){"use strict";function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r=t("./index.js"),n=t("./minitext"),v=t("../webGL/batcher"),y=v.renderers,m=4,_=6,x=0,b=0,o=n(),w=o,s=r.prototype.resize;r.prototype.resize=function(t,e){return this._cursor.i=0,this._cursor.j=0,s.call(this,t,e),this};var a=r.prototype.cls;r.prototype.cls=function(){return a.call(this),this.locate(0,0),this},r.prototype.locate=function(t,e){return this._cursor.i=~~t,this._cursor.j=~~e,this},r.prototype.print=function(e,t,i){if("object"===g(e))try{e=JSON.stringify(e)}catch(t){e="[Object]"}else"string"!=typeof e&&(e=e.toString());var r=v.prepare(y.colorSprite,w,this),n=this.palette[this._pen],o=n.r,s=n.g,a=n.b;if(void 0!==t){t=~~Math.round(t-this.camera.x),i=~~Math.round(i-this.camera.y);for(var h=t,u=0;u<e.length;u++){if(10!==(d=e.charCodeAt(u))&&13!==d)if((d-=32)<0||255<d)t+=m;else{var l=m*(d%16)+x,c=_*~~(d/16)+b;r.pushSprite(t,i,m,_,l,c,o,s,a),t+=m}else i+=_,t=h}return this}u=this._cursor.i;for(var p=this._cursor.j,f=0;f<e.length;f++){var d;if(this.width-u*m<m&&(u=0,p+=1),this.height-p*_<_&&(this.textScroll(),--p,r=v.prepare(y.colorSprite,w,this)),10!==(d=e.charCodeAt(f))&&13!==d)if((d-=32)<0||255<d)u+=1;else{l=m*(d%16)+x,c=_*~~(d/16)+b;r.pushSprite(u*m,p*_,m,_,l,c,o,s,a),u+=1}else p+=1,u=0}return this._cursor.i=u,this._cursor.j=p,this},r.prototype.println=function(t){return this.print(t),this.print("\n"),this},r.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=_,this._copyTexture||(this._copyTexture=new r(this.width,this.height)),this._copyTexture.draw(this,0,0),this.cls(),this.draw(this._copyTexture,0,-t),this},r.prototype.setCharset=function(t){var e=this._cursor.i*m,i=this._cursor.j*_;m=~~((w=t||o).width/16),_=~~(w.height/6),this._cursor.i=Math.ceil(e/m),this._cursor.j=Math.ceil(i/_),b=x=0,w._isSprite&&(x=w.x,b=w.y,w=w.img)}},{"../webGL/batcher":29,"./index.js":14,"./minitext":15}],17:[function(t,e,i){"use strict";var c=t("./index.js"),r=t("../webGL/context"),p=t("../webGL/batcher"),n=r.gl,f=p.renderers,o=t("..").settings,h=~~o.tileSize.width,u=~~o.tileSize.height;function s(t,e){if(t.ox=0,t.oy=0,e._isImageWrapper&&(e=e.asset),e._isSprite)t.ox=e.x,t.oy=e.y,t.tilesheet=e.img;else{if(e._isMap)throw new Error("TileMap cannot be used as tilesheet if using webGL");e._isTexture?t.tilesheet=e.canvas:(e._isGlTexture||e instanceof Image||e instanceof HTMLCanvasElement)&&(t.tilesheet=e)}}c.prototype._init=function(){if(0===this.width||0===this.height)return this.ctx=null,void(this.framebuffer=null);this.ctx=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.ctx),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this.width,this.height,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this.framebuffer=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.ctx,0)},c.prototype.setCamera=function(t,e){return this.camera.x=t||0,this.camera.y=e||0,this},c.prototype.sprite=function(t,e,i,r,n,o){if(e=Math.round((e||0)-this.camera.x),i=Math.round((i||0)-this.camera.y),e>=this.width||i>=this.height||e<=-h||i<=-u)return this;var s=t%16*h+this.ox,a=u*~~(t/16)+this.oy;return p.prepare(f.sprite,this.tilesheet,this).pushSprite(e,i,h,u,s,a,r,n,o),this},c.prototype.draw=function(t,e,i,r,n,o){if(!t)return console.error("Invalid asset"),this;if(t._isNineSlice)return t._draw(this,e,i,r,n),this;if(t===this&&(this._copyTexture||(this._copyTexture=new c(this.width,this.height)),this._copyTexture.draw(this,0,0),t=this._copyTexture),t._isTileMap)return t._draw(e,i,r,n,o,this),this;if(e=Math.round((e||0)-this.camera.x),i=Math.round((i||0)-this.camera.y),e>=this.width||i>=this.height)return this;if(t._isSprite){var s=t;t=s.img;var a=s.x,h=s.y,u=s.width,l=s.height;if(e<=-u||i<=-l)return this;p.prepare(f.sprite,t,this).pushSprite(e,i,u,l,a,h,r,n,o)}else{if(e<=-t.width||i<=-t.height)return this;p.prepare(f.sprite,t,this).pushSprite(e,i,t.width,t.height,0,0,r,n,o)}return this},c.prototype.stretchDraw=function(t,e,i,r,n){if(t._isSprite){var o=t;t=o.img;var s=o.x,a=o.y,h=o.width,u=o.height,l=~~Math.round((e||0)-this.camera.x),c=~~Math.round((i||0)-this.camera.y);return p.prepare(f.sprite,t,this).pushStretchSprite(l,c,r,n,s,a,h,u),this}t._isTexture&&(t=t.canvas);l=~~Math.round((e||0)-this.camera.x),c=~~Math.round((i||0)-this.camera.y);return p.prepare(f.sprite,t,this).pushStretchSprite(l,c,r,n,0,0,img.width,img.height),this},c.prototype.clear=function(){return p.flush(),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer),n.viewport(0,0,this.width,this.height),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),this},c.prototype.cls=function(){var t=this.palette[this._paper];return p.flush(),n.bindFramebuffer(n.FRAMEBUFFER,this.framebuffer),n.viewport(0,0,this.width,this.height),n.clearColor(t.r/255,t.g/255,t.b/255,1),n.clear(n.COLOR_BUFFER_BIT),this},c.prototype.paper=function(t){return this._paper=t%this.palette.length,this},c.prototype.pen=function(t){return this._pen=t%this.palette.length,this},c.prototype.setTilesheet=function(t){if(t)return s(this,t),this;delete this.tilesheet},c.prototype.setGlobalTilesheet=function(t){s(c.prototype,t)},window.tilesheet=function(t){return c.prototype.setGlobalTilesheet(t)},window.texture=function(t){var e=new c(t.width,t.height);return e.clear().draw(t,0,0),e},c.prototype.rect=function(t,e,i,r){var n=this.palette[this._pen],o=p.prepare(f.color,null,this);return i<=2||r<=2?o.pushRect(t,e,i,r,n.r,n.g,n.b):(o.pushRect(t,e,i,1,n.r,n.g,n.b),o.pushRect(t,e+r-1,i,1,n.r,n.g,n.b),o.pushRect(t,e,1,r,n.r,n.g,n.b),o.pushRect(t+i-1,e,1,r,n.r,n.g,n.b)),this},c.prototype.rectf=function(t,e,i,r){var n=this.palette[this._paper];return p.prepare(f.color,null,this).pushRect(t,e,i,r,n.r,n.g,n.b),this},c.prototype.rectfill=c.prototype.rectf,c.prototype.resize=function(t,e){return this.width===t&&this.height===e||(this.width=t,this.height=e,this._init(),this._copyTexture&&(this._copyTexture=null)),this},c.prototype._isTexture=!0,c.prototype._isGlTexture=!0},{"..":24,"../webGL/batcher":29,"../webGL/context":30,"./index.js":14}],18:[function(t,e,i){"use strict";var r=t("../Texture"),n=t(".."),u=8,l=8;function c(t,e,i,r,n,o,s,a){this.x=~~t,this.y=~~e,this.sprite=~~i,this.flipH=!!r,this.flipV=!!n,this.flipR=!!o,this.flagA=!!s,this.flagB=!!a}function o(t,e){this._name="",this.width=0,this.height=0,this.items=[],this.texture=null,this.tilesheet=null,this._tilesheetPath="",t&&e&&this._init(t,e)}(e.exports=o).prototype._isTileMap=!0;var a,f,s={},h=[];o.getMap=function(t){return"string"==typeof t?s[t]:"number"==typeof t?h[t]:(console.error("Map does not exist",t),null)},o._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.warn("Map bank format incorrect"),{_type:"maps",maps:[]}):t:{_type:"maps",maps:[]}},o.loadBank=function(t){t=o._checkBankFormat(t),s={},h=[];for(var e=t.maps||[],i=0;i<e.length;i++)h.push((new o).load(e[i]))},o.setTileSize=function(t,e){u=~~t,l=~~e},Object.defineProperty(o.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&s[this._name]&&s[this._name]===this&&delete s[this._name],(this._name=t)&&!s[t]&&(s[t]=this)}}),o.prototype._init=function(t,e){this.width=t,this.height=e,this.items=[];for(var i=0;i<t;i++){this.items.push([]);for(var r=0;r<e;r++)this.items[i][r]=null}this.texture&&this.texture.resize(t*u,e*l)},o.prototype.resize=function(t,e){var i=this.items,r=Math.min(this.width,t),n=Math.min(this.height,e);this._init(t,e);for(var o=0;o<r;o++)for(var s=0;s<n;s++)this.items[o][s]=i[o][s];return this.redraw(),this},o.prototype.set=function(t,e,i,r,n,o,s,a){if(null==i)return this.remove(t,e);if(!(t<0||e<0||t>=this.width||e>=this.height)){var h=this.items[t][e]=new c(t,e,i,r,n,o,s,a);return this.texture&&(this.texture.ctx.clearRect(t*u,e*l,u,l),this.texture.sprite(h.sprite,h.x*u,h.y*l,h.flipH,h.flipV,h.flipR)),this}},o.prototype.remove=function(t,e){if(!(t<0||e<0||t>=this.width||e>=this.height))return this.items[t][e]=null,this.texture&&this.texture.ctx.clearRect(t*u,e*l,u,l),this},o.prototype.get=function(t,e){return t<0||e<0||t>=this.width||e>=this.height?null:this.items[t][e]},o.prototype.redraw=function(){if(!this.texture)return this;this.texture.clear();for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++){var i=this.items[t][e];i&&this.texture.sprite(i.sprite,i.x*u,i.y*l,i.flipH,i.flipV,i.flipR)}return this},o.prototype._prepareTexture=function(){this.texture=new r(this.width*u,this.height*l),this.texture.setTilesheet(this.tilesheet),this.redraw()},o.prototype.release=function(){this.texture=null},o.prototype.draw=function(t,e){this.texture||this._prepareTexture(),draw(this.texture,t,e)},o.prototype.setTilesheet=function(t){return this.tilesheet=t,this._tilesheetPath=t&&t.path||"",this.texture&&(this.texture.setTilesheet(t),this.redraw()),this},o.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();for(var e=t.split("/"),i=n.assets||{},r=0;r<e.length;r++)if(!(i=i[e[r]]))return console.warn("Could not find tilesheet",t);this.setTilesheet(i)},function(){for(var i="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",u={},t=0;t<i.length;t++)u[i[t]]=t;var l=i.length,c=l*l-1,p=Math.pow(2,13),o=c-p-1;function s(t){var e=t%l;return i[~~(t/l)]+i[e]}a=function(t){for(var e="",i=0,r=0;r<t.length;r++){var n=t[r];n===t[r+1]&&++i<o||(null===n&&(n=c),e+=s(n),i===o&&i--,0!==i&&(e+=s(p+i)),i=0)}return i===o&&i--,0!==i&&(e+=s(p+i)),e},f=function(t){for(var e=[],i=0;i<t.length;){var r=t[i++],n=t[i++],o=u[r]*l+u[n];if(o===c)e.push(null);else if(p<o)for(var s=o-p,a=e[e.length-1],h=0;h<s;h++)e.push(a);else e.push(o)}return e}}(),o.prototype.save=function(){for(var t=this.width,e=this.height,i=new Array(t*e),r=0;r<t;r++)for(var n=0;n<e;n++){var o=this.items[r][n];i[r+n*t]=o?o.sprite+(o.flipH<<8)+(o.flipV<<9)+(o.flipR<<10)+(o.flagA<<11)+(o.flagB<<12):null}return{w:t,h:e,name:this.name,sheet:this._tilesheetPath||"",data:a(i)}},o.prototype.load=function(t){this.texture=null;var e=t.w,i=t.h;this._init(e,i),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var r=f(t.data),n=0;n<e;n++)for(var o=0;o<i;o++){var s=r[n+o*e];if(null!==s){var a=255&s,h=s>>8&1,u=s>>9&1,l=s>>10&1,c=s>>11&1,p=s>>12&1;this.set(n,o,a,h,u,l,c,p)}}return this},o.prototype.copy=function(t,e,i,r){t=t||0,e=e||0,null==i&&(i=this.width),null==r&&(r=this.height);var n=new o(i,r);return n.paste(this,-t,-e),n},o.prototype.paste=function(t,e,i,r){e=e||0,i=i||0;for(var n=Math.min(t.width,this.width-e),o=Math.min(t.height,this.height-i),s=Math.max(0,-e),a=Math.max(0,-i),h=s;h<n;h++)for(var u=a;u<o;u++){var l=t.items[h][u];if(l)this.set(h+e,u+i,l.sprite,l.flipH,l.flipV,l.flipR,l.flagA,l.flagB);else{if(r)continue;this.remove(h+e,u+i)}}return this},o.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var e=0;e<this.height;e++)this.items[t][e]=null;return this.texture&&this.texture.clear(),this},o.prototype.find=function(t,e,i){if(null===t)return this._findNull();void 0===e&&(e=null),void 0===i&&(i=null);for(var r=[],n=0;n<this.width;n++)for(var o=0;o<this.height;o++){var s=this.items[n][o];if(s){var a=null===e||s.flagA===e,h=null===i||s.flagB===i;s.sprite===t&&a&&h&&r.push(s)}}return r},o.prototype._findNull=function(){for(var t=[],e=0;e<this.width;e++)for(var i=0;i<this.height;i++)null===this.items[e][i]&&t.push({x:e,y:i});return t}},{"..":24,"../Texture":14}],19:[function(t,e,i){"use strict";var r=t("./index.js"),I=t("../Texture"),C=t("../webGL/batcher"),B=t(".."),n=B.settings,G=n.tileSize.width,j=n.tileSize.height,D=n.screen.width,U=n.screen.height,F=C.renderers.sprite,O={false:{false:{false:{flipH:!1,flipV:!1,flipR:!0},true:{flipH:!0,flipV:!0,flipR:!1}},true:{false:{flipH:!0,flipV:!1,flipR:!0},true:{flipH:!1,flipV:!0,flipR:!1}}},true:{false:{false:{flipH:!1,flipV:!0,flipR:!0},true:{flipH:!0,flipV:!1,flipR:!1}},true:{false:{flipH:!0,flipV:!0,flipR:!0},true:{flipH:!1,flipV:!1,flipR:!1}}}};r.prototype._prepareTexture=function(){},r.prototype.release=function(){},r.prototype.redraw=function(){},r.prototype.draw=function(t,e,i,r,n){this._draw(t,e,i,r,n,B.$screen)},r.prototype._draw=function(t,e,i,r,n,o){var s=this.tilesheet||I.prototype.tilesheet,a=C.prepare(F,s,o),h=B.$screen.camera;t=Math.round((t||0)-h.x),e=Math.round((e||0)-h.y);var u=this.tilesheet||assets.tilesheet,l=0,c=0;if(u._isSprite&&(l=u.x,c=u.y),i||r||n){var p,f;f=n?(p=this.height,this.width):(p=this.width,this.height);for(var d=Math.max(0,~~(-t/G)),g=Math.max(0,~~(-e/j)),v=Math.min(p,~~(1+(D-t)/G)),y=Math.min(f,~~(1+(U-e)/j)),m=g;m<y;m++)for(var _=d;_<v;_++){var x,b;if(b=n?(x=m,this.height-1-_):(x=_,m),i&&(x=this.width-1-x),r&&(b=this.height-1-b),P=this.get(x,b)){var w,S,T,A=(L=P.sprite)%16*G+l,k=~~(L/16)*j+c,R=t+_*G,E=e+m*j;if(n){var M=O[P.flipH][P.flipV][P.flipR];w=M.flipH,S=M.flipV,T=M.flipR,i&&(S=!S),r&&(w=!w)}else w=P.flipH,S=P.flipV,T=P.flipR,i&&(w=!w),r&&(S=!S);a.pushSprite(R,E,G,j,A,k,w,S,T)}}}else for(d=Math.max(0,~~(-t/G)),g=Math.max(0,~~(-e/j)),v=Math.min(this.width,~~(1+(D-t)/G)),y=Math.min(this.height,~~(1+(U-e)/j)),m=g;m<y;m++)for(_=d;_<v;_++){var P;if(P=this.get(_,m)){var L;A=(L=P.sprite)%16*G+l,k=~~(L/16)*j+c,R=t+_*G,E=e+m*j;a.pushSprite(R,E,G,j,A,k,P.flipH,P.flipV,P.flipR)}}},e.exports=r},{"..":24,"../Texture":14,"../webGL/batcher":29,"./index.js":18}],20:[function(t,e,i){"use strict";function f(t,e){var i=new Image;i.onload=function(){this.onload=null,this.onerror=null,e&&e(null,this)},i.onerror=function(){this.onload=null,this.onerror=null,e&&e("img:"+t)},i.src=t}function d(t,e){var i=new Audio;function r(){e&&e(null,i),i.removeEventListener("canplaythrough",r),i.removeEventListener("error",n)}function n(){e&&e("snd:load"),i.removeEventListener("canplaythrough",r),i.removeEventListener("error",n)}i.preload=!0,i.loop=!1,i.addEventListener("canplaythrough",r),i.addEventListener("error",n),i.src=t,i.load()}i.loadData=function(t,e,i){var r=new XMLHttpRequest;r.responseType=e||"arraybuffer",r.onreadystatechange=function(){if(4==~~r.readyState)return 200!=~~r.status&&0!=~~r.status?i&&i("xhrError:"+r.status):i&&i(null,r.response)},r.open("GET",t,!0),r.send()},i.loadJson=function(t,e){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==~~i.readyState)return 200!=~~i.status?e("xhrError:"+i.status):e&&e(null,JSON.parse(i.response))},i.open("GET",t,!0),i.send()},i.loadImage=f,i.loadSound=d,i.preloadStaticAssets=function(r,n,o){var a=r.dat,s=r.img.length,h=s+r.snd.length,u=r.root,l=0,c=0;function p(){var i,t,e=l+c;o&&o(l,e,h,e/h),t=e<s?(i=r.img[e],f):(i=r.snd[e-s],d),c+=1,t(u+i,function(t,e){t||function(t,e){var i=t.split("/"),r=i.pop().split(".");r.pop(),r=r.join(".");for(var n=a,o=0,s=i.length;o<s;o++)n=n[i[o]];n[r]=e,i.push(r),e.name=r,e.path=i.join("/")}(i,e),(l+=1)+--c<h?p():0===c&&n(null,a)})}if(0===h)return n(null,a);for(var t=Math.min(5,h-1),e=0;e<=t;e++)p()}},{}],21:[function(t,e,i){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r,n;r=window,n=function(){return r={},n.m=i=[function(t,e,i){var n=i(4);function r(){this.name="",this.speed=20,this.pmin=0,this.pmax=127,this.snap=!1,this.steps=[],this.audio=null}(t.exports=r).prototype.serialize=function(){for(var t="",e=0;e<this.steps.length;e++)t+=this.steps[e].serialize();return{n:this.name,i:[this.speed,this.pmin,this.pmax,~~this.snap],s:t}},r.prototype.deserialize=function(t){this.name=t.n,this.speed=t.i[0],this.pmin=t.i[1],this.pmax=t.i[2],this.snap=!!t.i[3],this.audio=null,this.steps=[];for(var e=t.s,i=0;i<e.length;i+=3){var r=new n;r.deserialize(e,i),this.steps.push(r)}return this},r.prototype.check=function(){11<this.name.length&&(this.name=this.name.substr(0,11)),this.speed=Math.max(0,Math.min(53,~~this.speed)),this.pmin=Math.max(0,Math.min(101,~~this.pmin)),this.pmax=Math.max(26,Math.min(127,~~this.pmax));for(var t=0;t<this.steps.length;t++)this.steps[t].check()}},function(t,e){e.SAMPLE_RATE=44100,e.CHUNK_LENGTH=50},function(t,e,i){var r=i(3),n=i(0),o=new(i(6)),s=audioManager.getEmptySound().__proto__.constructor;if(!s.prototype._createAudioNodes)throw new Error("webAudio required");function a(t){s.call(this),this._data=t}function h(t){var e=new a(t);return t.audio=e}inherits(a,s),a.prototype.load=function(t){if(this._loaded)return t&&t(null,this);t&&this._onLoadQueuedCallback.push(t),this.buffer=o.generateSound(this._data),this.usedMemory=this.buffer.duration,this.audioManager.usedMemory+=this.buffer.duration,this._finalizeLoad(null)},n.prototype.play=function(t,e,i){this.audio?this.audio.play(t,e,i):h(this).play(t,e,i)};var u=new r,l=[];e.loadProgram=function(t){u.deserialize(t),assets.bleeper={};for(var e=l.length=0;e<u.sounds.length;e++){var i=u.sounds[e],r=h(i);l.push(r);var n=i.name;n&&(assets.bleeper[n]=r,audioManager.permanentSounds[n]=r)}return u},e.sounds=l},function(t,e,i){var n=i(0);function r(){this.version=1,this.sounds=[]}(t.exports=r).prototype.serialize=function(){for(var t=[],e=0;e<this.sounds.length;e++)t.push(this.sounds[e].serialize());return{_type:"Bleeper program",v:this.version,s:t}},r.prototype.deserialize=function(t){if("Bleeper program"!==t._type)throw new Error("Incorrect data type");this.version=t.v,this.sounds.length=0;for(var e=t.s,i=0;i<e.length;i++){var r=new n;r.deserialize(e[i]),this.sounds.push(r)}return this},r.prototype.check=function(){if(0!==this.sounds.length)for(var t=0;t<this.sounds.length;t++)this.sounds[t].check();else this.sounds.push(new n)}},function(t,e,i){var n=i(5);function r(){this.wave=0,this.pitch=0,this.volume=0}(t.exports=r).prototype.serialize=function(){var t=this.wave,e=this.pitch;return 92<this.pitch&&(t+=8,e-=92),n.encodeUint6(t)+n.encodeUint6(e)+n.encodeUint6(this.volume)},r.prototype.deserialize=function(t,e){var i=n.decodeUint6(t,e),r=n.decodeUint6(t,e+1);return this.volume=n.decodeUint6(t,e+2),8<=i&&(i-=8,r+=92),this.wave=i,this.pitch=r,this},r.prototype.check=function(){this.wave=Math.max(0,Math.min(7,~~this.wave)),this.pitch=Math.max(0,Math.min(93,~~this.pitch)),this.volume=Math.max(0,Math.min(62,~~this.volume))}},function(t,e){for(var i="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",n=i.length,o={},r=0;r<i.length;r++)o[i[r]]=r;e.encodeUint13=function(t){return i[~~(t/n)]+i[t%n]},e.encodeUint6=function(t){return i[t]},e.decodeUint13=function(t,e){var i=t[e],r=t[e+1];return o[i]*n+o[r]},e.decodeUint6=function(t,e){return o[t[e]]}},function(t,e,i){var u=i(7),r=i(8),n=i(1),l=n.SAMPLE_RATE,c=n.CHUNK_LENGTH;function o(){this.oscillator=new r}(t.exports=o).prototype.generateSound=function(t){var e=t.steps;if(0===e.length)return null;var i=(t.speed+1)*c,r=e.length*i+100,n=u.createBuffer(1,r,l),o=n.getChannelData(0);this.oscillator.reset();for(var s=0,a=0;s<e.length;s++){var h=e[s];this.oscillator.setStep(t,h),this.oscillator.generate(o,a,a+i),a+=i}return this.oscillator.generateEndDamping(o,a,a+100),n}},function(t,e){var i=new window.AudioContext;t.exports=i},function(t,e,i){var r=i(9),n=i(1).SAMPLE_RATE,o=2*Math.PI,s=[0,.12,.25,.37,.5,.62,.75,.87,.87,.75,.62,.5,.37,.25,.12,0,-.12,-.25,-.37,-.5,-.62,-.75,-.87,-1,-1,-.87,-.75,-.62,-.5,-.37,-.25,-.12];function a(){this._amp=1,this._oscPos=0,this._oscInc=0,this._oscState=1,this._oscOut=0,this._duty=0,this._prevOut=0,this.generate=this._generatePulse}(t.exports=a).prototype.reset=function(){this._oscPos=0,this._oscState=1,this._oscOut=0,this._prevOut=0},a.prototype.setStep=function(t,e){var i=t.pmin+(t.pmax-t.pmin-20)*e.pitch/93;switch(i=20+90*i/107,t.snap&&(i=Math.round(i)),this._oscInc=r.noteToFreq(i)/n,this._amp=e.volume/63,e.wave){case 0:this.generate=this._generatePulse,this._duty=.06;break;case 1:this.generate=this._generatePulse,this._duty=.12;break;case 2:this.generate=this._generatePulse,this._duty=.25;break;case 3:this.generate=this._generatePulse,this._duty=.5;break;case 4:this.generate=this._generateTriangle;break;case 5:this.generate=this._generateSine;break;case 6:this.generate=this._generateSaw,this._amp*=2;break;case 7:this.generate=this._generateNoise,this._oscInc=2.9*this._oscInc+.01}},a.prototype._generatePulse=function(t,e,i){for(var r=this._prevOut,n=e;n<i;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),r=this._oscPos>this._duty?this._amp:-this._amp,t[n]=r;this._prevOut=r},a.prototype._generateTriangle=function(t,e,i){for(var r=this._prevOut,n=e;n<i;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),r=s[~~(32*this._oscPos)]*this._amp,t[n]=r;this._prevOut=r},a.prototype._generateSine=function(t,e,i){for(var r=this._prevOut,n=e;n<i;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),r=Math.sin(this._oscPos*o)*this._amp,t[n]=r;this._prevOut=r},a.prototype._generateSaw=function(t,e,i){for(var r=this._prevOut,n=e;n<i;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),r=(this._oscPos-.5)*this._amp,t[n]=r;this._prevOut=r},a.prototype._generateNoise=function(t,e,i){for(var r=this._prevOut,n=e;n<i;n++){if(this._oscPos+=this._oscInc,1<this._oscPos){this._oscPos=this._oscPos%1;var o=!(16384&this._oscState)^!(8192&this._oscState);this._oscState=32767&(this._oscState<<1|o),this._oscOut=(16384&this._oscState)>>14}r=(this._oscOut-.5)*this._amp,t[n]=r}this._prevOut=r},a.prototype.generateEndDamping=function(t,e,i){for(var r=this._prevOut,n=e;n<i;n++)r*=.98,t[n]=r}},function(t,e){for(var n=[],i=0;i<128;i++)n.push(440*Math.pow(2,(i-69)/12));e.noteToFreqTable=n,e.noteToFreq=function(t){t<0&&(t=0),127<t&&(t=127);var e=~~t,i=t-e,r=n[e];return r+i*(n[1+e]-r)}}],n.c=r,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==o(e)&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2);function n(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var i,r},"object"==(void 0===i?"undefined":o(i))&&"object"==(void 0===e?"undefined":o(e))?e.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==(void 0===i?"undefined":o(i))?i.bleeper=n():r.bleeper=n()},{}],22:[function(t,e,i){"use strict";e.exports=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}},{}],23:[function(t,e,i){"use strict";var c=["A","B","X","Y","lb","rb","lt","rt","back","start","lp","rp","up","down","left","right"],r=!(!navigator||!navigator.getGamepads),p=!1,f=.2;function n(){this.available=!1,this.btn={},this.btnp={},this.btnr={},this.x=0,this.y=0,this.z=0,this.w=0,this.lt=0,this.rt=0,this._setupButtons()}n.prototype._setupButtons=function(){for(var t=0;t<c.length;t++){var e=c[t];this.btn[e]=!1,this.btnp[e]=!1,this.btnr[e]=!1}};var d=[new n,new n,new n,new n,window],o=new n;var s=r?function(){for(var t=navigator.getGamepads(),e=0;e<4;e++){var i=t[e],r=d[e];if(i){var n,o,s,a;r.available=!0,p&&(n=r.btn.right,o=r.btn.left,a=r.btn.down,s=r.btn.up);for(var h=0;h<c.length;h++){var u=c[h],l=i.buttons[h].pressed;r.btnp[u]=!r.btn[u]&&l,r.btnr[u]=r.btn[u]&&!l,r.btn[u]=l}r.x=i.axes[0],r.y=i.axes[1],r.z=i.axes[2],r.w=i.axes[3],r.lt=i.buttons[6].value,r.rt=i.buttons[7].value,p&&(r.btn.right=r.btn.right||r.x>f,r.btn.left=r.btn.left||r.x<-f,r.btn.down=r.btn.down||r.y>f,r.btn.up=r.btn.up||r.y<-f,r.btnp.right=r.btn.right&&!n,r.btnp.left=r.btn.left&&!o,r.btnp.down=r.btn.down&&!a,r.btnp.up=r.btn.up&&!s,r.btnr.right=!r.btn.right&&n,r.btnr.left=!r.btn.left&&o,r.btnr.down=!r.btn.down&&a,r.btnr.up=!r.btn.up&&s)}else r.available=!1}return d}:function(){return d};i.mapAnalogStickToDpad=function(t){p=!0,f=void 0===t?.3:t},i.update=function(){window.gamepads=s(),window.gamepad=function(){for(var t=0;t<c.length;t++){var e=c[t];o.btnp[e]=btnp[e]||d[0].btnp[e]||d[1].btnp[e]||d[2].btnp[e]||d[3].btnp[e],o.btnr[e]=btnr[e]||d[0].btnr[e]||d[1].btnr[e]||d[2].btnr[e]||d[3].btnr[e],o.btn[e]=btn[e]||d[0].btn[e]||d[1].btn[e]||d[2].btn[e]||d[3].btn[e]}return o.btn.up&&o.btn.down&&(o.btn.down=!1),o.btn.right&&o.btn.left&&(o.btn.left=!1),o}()}},{}],24:[function(t,e,i){"use strict";e.exports={}},{}],25:[function(t,e,i){"use strict";e.exports=function(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],26:[function(t,e,i){"use strict";function r(t,e,i,r,n,o,s,a){this.img=t,this.path=e,this.x=i,this.y=r,this.width=n,this.height=o,this.pivotX=s||0,this.pivotY=a||0}r.prototype._isSprite=!0,e.exports=r},{}],27:[function(t,e,i){"use strict";var r=t("./context").gl;function n(t){this.uShortView=new Uint16Array(t),this.binder=r.createBuffer(),this.length=0,this.vertexIndice=0}(e.exports=n).prototype.uploadData=function(){r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.binder),r.bufferData(r.ELEMENT_ARRAY_BUFFER,this.uShortView,r.STATIC_DRAW)},n.prototype.bindBuffer=function(){r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.binder)},n.prototype.reset=function(){this.length=0,this.vertexIndice=0}},{"./context":30}],28:[function(t,e,i){"use strict";var r=t("./context").gl;function n(t){this.arrayBuffer=new ArrayBuffer(t),this.floatView=new Float32Array(this.arrayBuffer),this.uLongView=new Uint32Array(this.arrayBuffer),this.longView=new Int32Array(this.arrayBuffer),this.uShortView=new Uint16Array(this.arrayBuffer),this.shortView=new Int16Array(this.arrayBuffer),this.byteView=new Uint8Array(this.arrayBuffer),this.uByteView=new Int8Array(this.arrayBuffer),this.binder=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.binder)}(e.exports=n).prototype.uploadData=function(){r.bindBuffer(r.ARRAY_BUFFER,this.binder),r.bufferData(r.ARRAY_BUFFER,this.arrayBuffer,r.DYNAMIC_DRAW)}},{"./context":30}],29:[function(t,e,i){"use strict";var r=t("./context"),n=t("./VertexBuffer"),o=t("./IndexBuffer"),s=t("./renderers/sprite"),a=t("./renderers/line"),h=t("./renderers/colorQuad"),u=t("./renderers/colorSprite"),l=r.gl;function c(){this._renderer=s,this._program=null,this._renderTarget=null,this._channel0=null,this._batchIndex=0,this.vertexBuffer=new n(65536),this.indexBuffer=new o(32768),this.quadIndexBuffer=new o(49152),this._initQuadIndexBuffer(),this.renderers={sprite:s,line:a,color:h,colorSprite:u}}c.prototype._initQuadIndexBuffer=function(){for(var t=this.quadIndexBuffer.uShortView,e=0,i=0;i<32768;i+=4)t[e]=i,t[e+1]=i+1,t[e+2]=i+2,t[e+3]=i,t[e+4]=i+2,t[e+5]=i+3,e+=6;this.quadIndexBuffer.uploadData()},c.prototype.prepare=function(t,e,i){e&&e._isSprite&&(e=e.img);var r=!1;return e!==this._channel0&&(r=!0),i!==this._renderTarget&&(r=!0),t!==this._renderer&&(r=!0),r&&this.flush(),this._renderer.batcher=null,(t.batcher=this)._renderer=t,this._program=t.program,this._renderTarget=i,this._channel0=e,this._renderer},c.prototype.flush=function(){if(0!==this._batchIndex){var t=this._renderTarget;l.bindFramebuffer(l.FRAMEBUFFER,t.framebuffer),l.viewport(0,0,t.width,t.height);var e=r.useProgram(this._renderer.program);this._renderer.render.call(this,e),this._batchIndex=0}},e.exports=new c},{"./IndexBuffer":27,"./VertexBuffer":28,"./context":30,"./renderers/colorQuad":32,"./renderers/colorSprite":33,"./renderers/line":34,"./renderers/sprite":35}],30:[function(t,e,i){"use strict";var r=t("../domUtils/createCanvas"),n=t("..").settings,o=n.screen.width,s=n.screen.height,a=n.screen.pixelSize.width,h=n.screen.pixelSize.height,u=r(o,s);u.style.width=o*a+"px",u.style.height=s*h+"px";var l=u.getContext("webgl",{antialias:!1,alpha:!1,depth:!1,failIfMajorPerformanceCaveat:!1,powerPreference:"default",premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1});l.viewport(0,0,u.width,u.height),l.enable(l.BLEND),l.disable(l.DEPTH_TEST),l.depthMask(!1);var c={},p=null;function f(t,e){var i=l.createShader(e);if(l.shaderSource(i,t),l.compileShader(i),!l.getShaderParameter(i,l.COMPILE_STATUS))throw new Error(l.getShaderInfoLog(i));return i}var d=new WeakMap;i.canvas=u,i.gl=l,i.programs=c,i.createProgram=function(t,e,i){if(t&&c[t])return c[t];var r=f(e,l.VERTEX_SHADER),n=f(i,l.FRAGMENT_SHADER),o=l.createProgram();if(l.attachShader(o,r),l.attachShader(o,n),l.linkProgram(o),!l.getProgramParameter(o,l.LINK_STATUS))throw l.deleteProgram(o),new Error(l.getProgramInfoLog(o));return t&&(c[t]=o),o},i.useProgram=function(t){if(p===t)return t;if(null!==p){var e=l.getProgramParameter(p,l.ACTIVE_ATTRIBUTES),i=l.getProgramParameter(t,l.ACTIVE_ATTRIBUTES);if(e<i)for(var r=e;r<i;r++)l.enableVertexAttribArray(r);else if(i<e)for(r=i;r<e;r++)l.disableVertexAttribArray(r)}return p=t,l.useProgram(t),t},i.bindTexture=function(t,e,i,r){var n,o,s;n=e._isGlTexture?e.ctx:(o=e,(s=d.get(o))||(s=l.createTexture(),l.bindTexture(l.TEXTURE_2D,s),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!0),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,o),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),d.set(o,s),s)),l.activeTexture(l.TEXTURE0+r),l.bindTexture(l.TEXTURE_2D,n),l.uniform1i(l.getUniformLocation(t,i),r)}},{"..":24,"../domUtils/createCanvas":22}],31:[function(t,e,i){"use strict";var o=t("./context"),s=t("./batcher"),a=t(".."),r=a.settings,h=o.gl,u=~~r.screen.width,l=~~r.screen.height,n=new Int16Array([0,l,0,l,u,l,u,l,0,0,0,0,u,l,u,l,u,0,u,0,0,0,0,0]),c=h.createBuffer();function p(t,e){var i=h.getAttribLocation(t,e);return h.enableVertexAttribArray(i),i}h.bindBuffer(h.ARRAY_BUFFER,c),h.bufferData(h.ARRAY_BUFFER,n,h.STATIC_DRAW),i.shaders=o.programs,i.context=o,i.canvas=o.canvas,i.gl=h,i.batcher=s,i.commit=function(){s.flush();var t,e,i,r,n=o.useProgram(o.programs.sprite);h.bindFramebuffer(h.FRAMEBUFFER,null),h.viewport(0,0,u,l),h.bindBuffer(h.ARRAY_BUFFER,c),h.uniform2f(h.getUniformLocation(n,"iChannel0Resolution"),u,l),h.uniform2f(h.getUniformLocation(n,"iResolution"),u,l),h.vertexAttribPointer(p(n,"a_coordinates"),2,h.SHORT,!1,8,0),h.vertexAttribPointer(p(n,"a_uv"),2,h.SHORT,!1,8,4),t=n,e=a.$screen,i="iChannel0",r=0,h.activeTexture(h.TEXTURE0+r),h.bindTexture(h.TEXTURE_2D,e.ctx),h.uniform1i(h.getUniformLocation(t,i),r),h.drawArrays(h.TRIANGLES,0,6)}},{"..":24,"./batcher":29,"./context":30}],32:[function(t,e,i){"use strict";var r=t("../context"),n=r.gl;function o(){this.batcher=null,this.program=r.createProgram("color",t("../shaders/color.vert"),t("../shaders/color.frag"))}o.prototype.pushRect=function(t,e,i,r,n,o,s){var a=t+i,h=e+r,u=(o<<8)+n,l=this.batcher.vertexBuffer.shortView,c=this.batcher.vertexBuffer.uShortView,p=this.batcher._batchIndex;l[p++]=t,l[p++]=e,c[p++]=u,c[p++]=s,l[p++]=a,l[p++]=e,c[p++]=u,c[p++]=s,l[p++]=a,l[p++]=h,c[p++]=u,c[p++]=s,l[p++]=t,l[p++]=h,c[p++]=u,c[p++]=s,p<32752?this.batcher._batchIndex=p:this.batcher.flush()},o.prototype.render=function(t){this.quadIndexBuffer.bindBuffer(),this.vertexBuffer.uploadData(),n.vertexAttribPointer(n.getAttribLocation(t,"a_coordinates"),2,n.SHORT,!1,8,0),n.vertexAttribPointer(n.getAttribLocation(t,"a_color"),4,n.UNSIGNED_BYTE,!0,8,4),n.uniform2f(n.getUniformLocation(t,"iResolution"),this._renderTarget.width,this._renderTarget.height);var e=this._batchIndex/4/4*6;n.drawElements(n.TRIANGLES,e,n.UNSIGNED_SHORT,0)},e.exports=new o},{"../context":30,"../shaders/color.frag":36,"../shaders/color.vert":37}],33:[function(t,e,i){"use strict";var r=t("../context"),n=r.gl;function o(){this.batcher=null,this.program=r.createProgram("colorSprite",t("../shaders/colorSprite.vert"),t("../shaders/colorSprite.frag"))}o.prototype.pushSprite=function(t,e,i,r,n,o,s,a,h){var u=t+i,l=e+r,c=n+i,p=o+r,f=(a<<8)+s,d=this.batcher.vertexBuffer.shortView,g=this.batcher.vertexBuffer.uShortView,v=this.batcher._batchIndex;d[v++]=t,d[v++]=e,d[v++]=n,d[v++]=o,g[v++]=f,g[v++]=h,d[v++]=u,d[v++]=e,d[v++]=c,d[v++]=o,g[v++]=f,g[v++]=h,d[v++]=u,d[v++]=l,d[v++]=c,d[v++]=p,g[v++]=f,g[v++]=h,d[v++]=t,d[v++]=l,d[v++]=n,d[v++]=p,g[v++]=f,g[v++]=h,v<32744?this.batcher._batchIndex=v:this.batcher.flush()},o.prototype.render=function(t){this.quadIndexBuffer.bindBuffer(),this.vertexBuffer.uploadData(),n.vertexAttribPointer(n.getAttribLocation(t,"a_coordinates"),2,n.SHORT,!1,12,0),n.vertexAttribPointer(n.getAttribLocation(t,"a_uv"),2,n.SHORT,!1,12,4),n.vertexAttribPointer(n.getAttribLocation(t,"a_color"),4,n.UNSIGNED_BYTE,!0,12,8),n.uniform2f(n.getUniformLocation(t,"iResolution"),this._renderTarget.width,this._renderTarget.height),n.uniform2f(n.getUniformLocation(t,"iChannel0Resolution"),this._channel0.width,this._channel0.height),r.bindTexture(t,this._channel0,"iChannel0",0);var e=this._batchIndex/6/4*6;n.drawElements(n.TRIANGLES,e,n.UNSIGNED_SHORT,0)},e.exports=new o},{"../context":30,"../shaders/colorSprite.frag":38,"../shaders/colorSprite.vert":39}],34:[function(t,e,i){"use strict";var r=t("../context"),n=r.gl;function o(){this.batcher=null,this.program=r.createProgram("line",t("../shaders/color.vert"),t("../shaders/color.frag"))}o.prototype.pushLines=function(t,e,i,r){},o.prototype.pushRect=function(t,e,i,r,n,o,s){var a=t+i,h=e+r-1;t+=1;var u=(o<<8)+n,l=this.batcher.vertexBuffer,c=l.shortView,p=l.uShortView,f=this.batcher._batchIndex;c[f++]=t,c[f++]=e,p[f++]=u,p[f++]=s,c[f++]=a,c[f++]=e,p[f++]=u,p[f++]=s,c[f++]=a,c[f++]=h,p[f++]=u,p[f++]=s,c[f++]=t,c[f++]=h,p[f++]=u,p[f++]=s,this.batcher._batchIndex=f;var d=this.batcher.indexBuffer,g=d.uShortView,v=(f=d.length,d.vertexIndice);g[f++]=v+0,g[f++]=v+1,g[f++]=v+1,g[f++]=v+2,g[f++]=v+2,g[f++]=v+3,g[f++]=v+3,g[f++]=v+0,d.length=f,d.vertexIndice+=4,32752<=f&&this.batcher.flush()},o.prototype.render=function(t){this.indexBuffer.uploadData(),this.vertexBuffer.uploadData(),n.vertexAttribPointer(n.getAttribLocation(t,"a_coordinates"),2,n.SHORT,!1,8,0),n.vertexAttribPointer(n.getAttribLocation(t,"a_color"),4,n.UNSIGNED_BYTE,!0,8,4),n.uniform2f(n.getUniformLocation(t,"iResolution"),this._renderTarget.width,this._renderTarget.height),n.drawElements(n.LINES,this.indexBuffer.length,n.UNSIGNED_SHORT,0),this.indexBuffer.reset()},e.exports=new o},{"../context":30,"../shaders/color.frag":36,"../shaders/color.vert":37}],35:[function(t,e,i){"use strict";var r=t("../context"),n=r.gl;function o(){this.batcher=null,this.program=r.createProgram("sprite",t("../shaders/sprite.vert"),t("../shaders/sprite.frag"))}o.prototype.pushQuad=function(t,e,i,r,n,o,s,a,h,u,l,c,p,f,d,g){var v=this.batcher.vertexBuffer.shortView,y=this.batcher._batchIndex;v[y++]=t,v[y++]=e,v[y++]=i,v[y++]=r,v[y++]=n,v[y++]=o,v[y++]=s,v[y++]=a,v[y++]=h,v[y++]=u,v[y++]=l,v[y++]=c,v[y++]=p,v[y++]=f,v[y++]=d,v[y++]=g,y<32752?this.batcher._batchIndex=y:this.batcher.flush()},o.prototype.pushSprite=function(t,e,i,r,n,o,s,a,h){var u,l,c,p=n+i,f=o+r;if(h){u=t+r,l=e+i;var d=n,g=f,v=n,y=o,m=p,_=o,x=p,b=f;s&&(c=g,g=y,y=c,c=b,b=_,_=c),a&&(c=d,d=m,m=c,c=v,v=x,x=c),this.pushQuad(t,e,d,g,u,e,v,y,u,l,m,_,t,l,x,b)}else u=t+i,l=e+r,s&&(c=n,n=p,p=c),a&&(c=o,o=f,f=c),this.pushQuad(t,e,n,o,u,e,p,o,u,l,p,f,t,l,n,f)},o.prototype.pushStretchSprite=function(t,e,i,r,n,o,s,a){var h=n+s,u=o+a,l=t+i,c=e+r;this.pushQuad(t,e,n,o,l,e,h,o,l,c,h,u,t,c,n,u)},o.prototype.render=function(t){this.quadIndexBuffer.bindBuffer(),this.vertexBuffer.uploadData(),n.vertexAttribPointer(n.getAttribLocation(t,"a_coordinates"),2,n.SHORT,!1,8,0),n.vertexAttribPointer(n.getAttribLocation(t,"a_uv"),2,n.SHORT,!1,8,4),n.uniform2f(n.getUniformLocation(t,"iResolution"),this._renderTarget.width,this._renderTarget.height),n.uniform2f(n.getUniformLocation(t,"iChannel0Resolution"),this._channel0.width,this._channel0.height),r.bindTexture(t,this._channel0,"iChannel0",0);var e=this._batchIndex/4/4*6;n.drawElements(n.TRIANGLES,e,n.UNSIGNED_SHORT,0)},e.exports=new o},{"../context":30,"../shaders/sprite.frag":40,"../shaders/sprite.vert":41}],36:[function(t,e,i){e.exports="precision mediump float;\n\nvarying vec4 iColor;\n\nvoid main() {\n\tvec4 color = iColor;\n\tcolor.a = 1.0;\n\tgl_FragColor = color;\n}\n"},{}],37:[function(t,e,i){e.exports="uniform   vec2 iResolution;\nattribute vec2 a_coordinates;\nattribute vec4 a_color;\nvarying   vec4 iColor;\n\nvoid main(void) {\n\tgl_Position = vec4(\n\t\ta_coordinates.x *  2.0 / iResolution.x - 1.0,\n\t\ta_coordinates.y * -2.0 / iResolution.y + 1.0,\n\t\t0.0,\n\t\t1.0\n\t);\n\tiColor = a_color;\n}\n"},{}],38:[function(t,e,i){e.exports="precision mediump float;\n\nuniform sampler2D iChannel0;\nvarying vec2 fragCoord;\nvarying vec4 iColor;\n\nvoid main(void) {\n\tvec4 color = texture2D(iChannel0, fragCoord);\n\tif (color.a == 0.0) discard;\n\tgl_FragColor = iColor;\n}\n"},{}],39:[function(t,e,i){e.exports="uniform   vec2 iResolution;\nuniform   vec2 iChannel0Resolution;\nattribute vec2 a_coordinates;\nattribute vec2 a_uv;\nattribute vec4 a_color;\nvarying   vec2 fragCoord;\nvarying   vec4 iColor;\n\nvoid main(void) {\n\tgl_Position = vec4(\n\t\ta_coordinates.x *  2.0 / iResolution.x - 1.0,\n\t\ta_coordinates.y * -2.0 / iResolution.y + 1.0,\n\t\t0.0,\n\t\t1.0\n\t);\n\tfragCoord = vec2(a_uv.x / iChannel0Resolution.x, 1.0 - a_uv.y / iChannel0Resolution.y);\n\tiColor = vec4(a_color.rgb, 1.0);\n}\n"},{}],40:[function(t,e,i){e.exports="precision mediump float;\n\nuniform sampler2D iChannel0;\nvarying vec2 fragCoord;\n\nvoid main(void) {\n\tvec4 color = texture2D(iChannel0, fragCoord);\n\tif (color.a == 0.0) discard;\n\tgl_FragColor = color;\n}\n"},{}],41:[function(t,e,i){e.exports="uniform   vec2 iResolution;\nuniform   vec2 iChannel0Resolution;\nattribute vec2 a_coordinates;\nattribute vec2 a_uv;\nvarying   vec2 fragCoord;\n\nvoid main(void) {\n\tgl_Position = vec4(\n\t\ta_coordinates.x *  2.0 / iResolution.x - 1.0,\n\t\ta_coordinates.y * -2.0 / iResolution.y + 1.0,\n\t\t0.0,\n\t\t1.0\n\t);\n\tfragCoord = vec2(a_uv.x / iChannel0Resolution.x, 1.0 - a_uv.y / iChannel0Resolution.y);\n}\n"},{}],42:[function(t,e,i){"use strict";t("./platforms.js");function w(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||f(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){if(t){if("string"==typeof t)return r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}var s=256,a=256,h=Math.floor(s/2),u=Math.floor(a/2),l=assets.backgrounds.bg1,c=assets.backgrounds.bg1b,p=assets.tilesheet,g=assets.tilesheet_mountain,v=assets.tilesheet2,y=assets.tilesheet_enemies,m=assets.animations.title_screen.a,_=(assets.tilesheet_terrain,[assets.animations.thal_speech.face0,assets.animations.thal_speech.face1]),x=(assets.animations.enx_speech.face0,assets.animations.enx_speech.face1,[0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,1,1,1,0]),b=0,S=assets.info_bar;var T=document.getElementById("world_id_info").innerHTML,A=(document.getElementById("save_state_info").innerHTML,function(t,e){for(var i,r=function(t){for(var e=0,i=1779033703^t.length;e<t.length;e++)i=(i=Math.imul(i^t.charCodeAt(e),3432918353))<<13|i>>>19;return function(){return i=Math.imul(i^i>>>16,2246822507),i=Math.imul(i^i>>>13,3266489909),(i^=i>>>16)>>>0}}(t),n=(i=r(),function(){var t=i+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}),o=[],s=0;s<e;s++)o.push(n());return o}(T,1e4)),k=0;function R(t,e){var i=t+Math.floor(A[k]*(e-t));return++k>=A.length&&(k=0),i}var E={peak:{10:["peakright","peak"],11:["peakleft","peak"],12:["mountain"],13:["sky"],4:["insidecavetop"]},peakright:{10:["sky"],11:["peak"],12:["cliffright"],13:["sky"],4:["insidecavetop"]},peakleft:{10:["peak"],11:["sky"],12:["cliffleft"],13:["sky"],4:["insidecavetop"]},mountain:{10:["mountain","cliffright"],11:["mountain","cliffleft"],12:["mountain","caveground"],13:["mountain","peak"],4:["insidecave"]},cliffright:{10:["aboveground"],11:["mountain"],12:["cliffright","caveright"],13:["cliffright","peakright"],4:["insidecave"]},cliffleft:{10:["mountain"],11:["aboveground"],12:["cliffleft","caveleft"],13:["cliffleft","peakleft"],4:["insidecave"]},caveground:{10:["caveground","caveright"],11:["caveground","caveleft"],12:["underground"],13:["mountain"],4:["insidecave"]},caveleft:{10:["caveground"],11:["ground","caveright"],12:["underground"],13:["cliffleft"],4:["insidecave"]},caveright:{10:["ground","caveleft"],11:["caveground"],12:["underground"],13:["cliffright"],4:["insidecave"]},underground:{10:["underground"],11:["underground"],12:["underground"],13:["underground","ground"],4:["underground"]},ground:{10:["ground","caveleft","towergroundleft"],11:["ground","caveright","towergroundright"],12:["underground"],13:["aboveground"],4:["underground"]},aboveground:{10:["aboveground","cliffleft","roofleft"],11:["aboveground","cliffright","roofright"],12:["ground"],13:["sky"]},sky:{10:["sky","peakleft","roofleft"],11:["sky","peakright","roofright"],12:["aboveground"],13:["sky"]},roof:{10:["roofright","roof"],11:["roofleft","roof"],12:["tower"],13:["sky"],4:["insidetowertop"]},roofright:{10:["sky"],11:["roof"],12:["towerright"],13:["sky"],4:["insidetowertop"]},roofleft:{10:["roof"],11:["sky"],12:["roofleft"],13:["sky"],4:["insidetowertop"]},tower:{10:["towerright"],11:["towerleft"],12:["towerground"],13:["roof"],4:["insidetower"]},towerright:{10:["aboveground"],11:["tower"],12:["towergroundright"],13:["roofright"],4:["insidetower"]},towerleft:{10:["tower"],11:["aboveground"],12:["towergroundleft"],13:["roofleft"],4:["insidetower"]},towerground:{10:["towergroundright"],11:["towergroundleft"],12:["underground"],13:["tower"],4:["insidetowerground"]},towergroundright:{10:["ground"],11:["towerground"],12:["underground"],13:["towerright"],4:["insidetowerground"]},towergroundleft:{10:["towerground"],11:["ground"],12:["underground"],13:["towerleft"],4:["insidetowerground"]},insidecavetop:{10:["insidecavetop"],11:["insidecavetop"],12:["insidecave"],13:["peak","peakleft","peakright"],4:["peak","peakleft","peakright","mountain","cliffleft","cliffright"]},insidecave:{10:["insidecave"],11:["insidecave"],12:["insidecave"],13:["insidecave","insidecavetop"],4:["insidecave","mountain","cliffleft","cliffright","caveground","caveleft","caveright"]},insidetowertop:{10:["insidetowertop"],11:["insidetowertop"],12:["insidetower"],13:["roof","roofleft","roofright"],4:["roof","roofleft","roofright","insidetowertop"]},insidetower:{10:["insidetower"],11:["insidetower"],12:["insidetowerground"],13:["insidetowertop"],4:["insidetower","tower","towerleft","towerright"]},insidetowerground:{10:["insidetowerground"],11:["insidetowerground"],12:["basement"],13:["insidetower"],4:["insidetowerground","towerground","towergroundleft","towergroundright"]},basement:{10:["basement"],11:["basement"],12:["basement"],13:["basement","insidetower"],4:["basement"]}};function M(t){return[t,t+1,t+16,t+17,t+32,t+33]}var P=[{idle:144,jump:54,run:148,fall:54,shoot:56,slide:148,skid:106,climb:102,door:56},{idle:0,jump:48,run:4,fall:48,shoot:50,slide:4,skid:100,climb:112,door:52},{idle:0,jump:48,run:4,fall:12,shoot:50,slide:6,skid:100,climb:102}],L=0,I=2,C={x:24,y:232},B={x:40,y:232},G=M(P[L].idle),j=M(P[I].idle),D=!1,U=!1,F=[];function O(t,e,i,r){var n={image:192,x:t,y:e-3,vx:2<arguments.length&&void 0!==i?i:0,vy:3<arguments.length&&void 0!==r?r:0,frame:0,frames:[0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,1,2,1,2,1,2,1,2,1,2,2,2,2,2,3,2,3,2,3,2,3,2],last_hit:"",alive:!0};F.push(n)}var N=[];function $(t,e,i,r){var n={image:208,x:t,y:e-8,vx:2<arguments.length&&void 0!==i?i:0,vy:3<arguments.length&&void 0!==r?r:0,frame:0,frames:[0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9],alive:!0};N.push(n)}var V=!1,z=[];var H=[];function X(t){return t+8+1}function q(t){return t-1}function W(t){return t+8+1}function Y(t){return t-1}var Q=0,Z=0;function J(t,e){var i=Math.floor(t/8),r=Math.floor(e/8);return Ze<=i||Je<=r||i<0||r<0?1:Ye[r][i]}function K(t,e){var i=Math.floor(t/8),r=Math.floor(e/8);return Ze<=i||Je<=r||i<0||r<0?1:Qe[r][i]}function tt(t){return 8*Math.floor(q(t)/8)+8}function et(t){return 8*Math.floor(t/8)}function it(t){return 8*Math.floor(t/8)+8}function rt(t){return 8*Math.floor(t/8)}Math.floor(C.x/8),Math.floor(B.x/8),Math.floor(C.y/8),Math.floor(B.y/8);var nt=0,ot=0,st=0,at=0,ht=!1,ut=!1,lt=!1,ct=!1,pt=!1,ft=!1,dt=!1,gt=!1,vt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],yt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],mt=0,_t=0,xt=[0,0,0,0,0,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5],bt=[0,0,0,0,0,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,5,5,5,5,5],wt=0,St=0,Tt=!1,At=!1,kt=[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],Rt=[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],Et=0,Mt=0,Pt=!1,Lt=!1,It=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Ct=[0,0,0,0,0,0,0,0,0,0,0],Bt=0,Gt=0,jt=0,Dt=0,Ut=!1,Ft=!1,Ot=[4,4,3,3,3,3,2,2,2,2,2,1,1,1,1,1,1,1,1],Nt=[3,3,3,3,3,2,2,2,2,1,1,1,1,1],$t=0,Vt=0,zt=[0,0,0,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3],Ht=[0,0,0,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3],Xt=0,qt=0,Wt=!1,Yt=!1,Qt=[1,1,1,1,1,1,1,1,1,1,1,1,1,2],Zt=[1,1,1,1,1,1,1,1,1,1,1,1,1,2],Jt=0,Kt=0,te=!1,ee=!1,ie=[1,0],re=[2,2,2,2,1,1,1,1,1,1,1,1,0],ne=ie.length-1,oe=re.length-1,se=!1,ae=[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],he=0,ue=!1,le=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ce=0,pe=!1,fe=256,de=!1;function ge(){if(de){if(!btn.S||!btn.A)return void(b<x.length-1&&b++);de=!1,L=L?0:1}else btn.S&&btn.B&&(de=!0,b=0);if(ue)ce>=le.length-1?(ue=!1,ce=0,C.x=8*Re.gotox,C.y=8*Re.gotoy,Re={}):ce++;else{if(te&&(D?1==J(q(C.x-ie[ne]),C.y)?C.x=et(C.x):C.x-=ie[ne]:1==J(X(C.x+ie[ne]),C.y)?C.x=tt(C.x):C.x+=ie[ne],(ne+=1)>=ie.length-1&&(te=!1)),btn.R){if(C.x>=Ke-9&&11==K(C.x,C.y))return void(Oe=be(11));D&&(Jt=0,Wt&&pt&&(assets.bleeper.urch.play(),Pt=!0)),te=!(Wt=!(D=!1)),ne=4,1==J(X(C.x+Qt[Jt]),C.y)?(!ht&&C.x<Ke-16&&(console.log(C.x+" "+Ke),assets.bleeper.bump.play(),ht=!0),C.x=tt(C.x),Wt=!1):(C.x+=Qt[Jt],ht=!1),Jt<Qt.length-1&&3<=Qt[Jt+=1]&&(ne=0)}else if(btn.L){if(C.x<=1&&10==K(C.x,C.y))return void(Oe=be(10));D||(Jt=0,Wt&&pt&&(assets.bleeper.urch.play(),Pt=!0)),te=!(Wt=D=!0),ne=4,1==J(q(C.x-Qt[Jt]),C.y)?(ht||(assets.bleeper.bump.play(),ht=!0),C.x=et(C.x),Wt=!1):(C.x-=Qt[Jt],ht=!1),Jt<Qt.length-1&&3<=Qt[Jt+=1]&&(ne=0)}else ne<ie.length-1&&(te=!0),Wt=!1,Jt=0;if(pt?0==J(C.x,W(C.y))&&0==J(C.x+7,W(C.y))&&(se||(pt=!1)):se&&(pt=!0),2!=J(C.x,C.y)&&2!=J(C.x+7,C.y)&&(se=!1),btn.A){if(!(btn.L||btn.R||4!=K(C.x,C.y)&&4!=K(C.x+7,C.y)))return ue=!0,void(Oe=be(4));if(13==K(C.x,C.y)||13==K(C.x+7,C.y))return void(Oe=be(13));2==J(C.x,C.y)||2==J(C.x+7,C.y)?(se=!0,he++,C.y--,he%8==0&&assets.bleeper.climb.play()):pt||dt?1==J(C.x,Y(C.y))||1==J(C.x+7,Y(C.y))?lt||(assets.bleeper.bonk.play(),lt=!0):(assets.bleeper.jump.play(),st=Y(C.y-Ot[$t]),1==J(C.x,st)||1==J(C.x+7,st)?(C.y=rt(C.y),assets.bleeper.bonk.play(),Ut=!1,$t=0):C.y-=Ot[$t],dt=pt=!(Ut=!0)):Ut&&(st=Y(C.y-Ot[$t]),1==J(C.x,st)||1==J(C.x+7,st)?(C.y=rt(C.y),assets.bleeper.bonk.play(),Ut=!1,$t=0):C.y-=Ot[$t],($t+=1)>=Ot.length-1&&(Ut=!1,$t=0))}else $t=0,lt=Ut=!1;btn.D&&(2!=J(C.x,C.y)&&2!=J(C.x+7,C.y)||(se=!0,he++,C.y++,he%8==0&&assets.bleeper.climb.play()),12==K(C.x,C.y)||12==K(C.x+7,C.y))?Oe=be(12):(Ut||pt?Xt=0:(nt=W(C.y+zt[Xt]),1==J(C.x,nt)||1==J(C.x+7,nt)?(C.y=it(C.y),pt=!0,Xt=0,assets.bleeper.land.play()):(C.y+=zt[Xt],Xt<zt.length-1&&(Xt+=1))),1==J(C.x,C.y+7)&&0==J(C.x+7,C.y+7)?C.x=et(C.x+7):0==J(C.x,C.y+7)&&1==J(C.x+7,C.y+7)&&(C.x=tt(C.x-4)),Pt&&(Bt<It.length-1?Bt++:(Pt=!1,Bt=0)),btn.B&&(Tt||de||(Tt=!0,assets.bleeper.shoot.play(),O(C.x,C.y,D?-2:2,0))),Tt&&(Et<kt.length-1?Et++:(Tt=!1,Et=0)),V&&$(C.x,C.y,0,0),C.x+=function(){for(var t=[],e=0;e<z.length;e++){var i=z[e];Math.abs(C.x-i.x)<8&&Math.abs(C.y-i.y)<8&&t.push(i)}for(var r=0,n=0;n<t.length;n++){var o=t[n];if(C.y<o.y){C.y=o.y-8,dt=pt=!0;var s=o.vframe-1;s<0&&(s=o.vx.length-1),r=o.vx[s]}}return r}(),ve=C.x<h?h-C.x:0,ye=C.x>Ke-h?C.x-Ke+h:0,me=C.y<u?u-C.y:0,_e=C.y>ti-u?C.y-ti+u:0)}}var ve=0,ye=0,me=0,_e=0;function xe(){ee&&(U?1==J(q(B.x-re[oe]),B.y)?B.x=et(B.x):B.x-=re[oe]:1==J(X(B.x+re[oe]),B.y)?B.x=tt(B.x):B.x+=re[oe],(oe+=1)>=re.length-1&&(ee=!1)),btn.R2?(U&&(Kt=0,Yt&&ft&&(assets.bleeper.urch.play(),Lt=!0)),ee=!(Yt=!(U=!1)),oe=4,1==J(X(B.x+Zt[Kt]),B.y)?(ut||(assets.bleeper.bump.play(),ut=!0),B.x=tt(B.x),Yt=!1):(B.x+=Zt[Kt],ut=!1),Kt<Zt.length-1&&3<=Zt[Kt+=1]&&(oe=0)):btn.L2?(U||(Kt=0,Yt&&ft&&(assets.bleeper.urch.play(),Lt=!0)),ee=!(Yt=U=!0),oe=4,1==J(q(B.x-Zt[Kt]),B.y)?(ut||(assets.bleeper.bump.play(),ut=!0),B.x=et(B.x),Yt=!1):(B.x-=Zt[Kt],ut=!1),Kt<Zt.length-1&&3<=Zt[Kt+=1]&&(oe=0)):(oe<re.length-1&&(ee=!0),Yt=!1,Kt=0),ft&&0==J(B.x,W(B.y))&&0==J(B.x+7,W(B.y))&&(ft=!1),btn.A2?ft||gt?1==J(B.x,Y(B.y))||1==J(B.x+7,Y(B.y))?ct||(assets.bleeper.bonk.play(),ct=!0):(assets.bleeper.jump.play(),at=Y(B.y-Nt[Vt]),1==J(B.x,at)||1==J(B.x+7,at)?(B.y=rt(B.y),assets.bleeper.bonk.play(),Ft=!1,Vt=0):B.y-=Nt[Vt],gt=ft=!(Ft=!0)):Ft&&(at=Y(B.y-Nt[Vt]),1==J(B.x,at)||1==J(B.x+7,at)?(B.y=rt(B.y),assets.bleeper.bonk.play(),Ft=!1,Vt=0):B.y-=Nt[Vt],(Vt+=1)>=Nt.length-1&&(Ft=!1,Vt=0)):(Vt=0,ct=Ft=!1),Ft||ft?qt=0:(ot=W(B.y+Ht[qt]),1==J(B.x,ot)||1==J(B.x+7,ot)?(B.y=it(B.y),ft=!0,qt=0,assets.bleeper.land.play()):(B.y+=Ht[qt],qt<Ht.length-1&&(qt+=1))),1==J(B.x,B.y+7)&&0==J(B.x+7,B.y+7)?B.x=et(B.x+7):0==J(B.x,B.y+7)&&1==J(B.x+7,B.y+7)&&(B.x=tt(B.x-4)),Lt&&(Gt<Ct.length-1?Gt++:(Lt=!1,Gt=0)),btn.B2&&(At||(At=!0,assets.bleeper.shoot.play(),$(B.x,B.y,0,0))),At&&(Mt<Rt.length-1?Mt++:(At=!1,Mt=0)),V&&$(B.x,B.y,0,0),B.x+=function(){for(var t=[],e=0;e<z.length;e++){var i=z[e];Math.abs(B.x-i.x)<8&&Math.abs(B.y-i.y)<8&&t.push(i)}for(var r=0,n=0;n<t.length;n++){var o=t[n];if(B.y<o.y){B.y=o.y-8,gt=ft=!0;var s=o.vframe-1;s<0&&(s=o.vx.length-1),r=o.vx[s]}}return r}()}function be(t){console.log("checking door type "+t);for(var e=He.exits,i=0,r=Object.keys(e);i<r.length;i++){var n=r[i],o=e[n];if(o.type==t)return C.x=8*o.gotox,B.x=8*o.gotox,C.y=8*o.gotoy,B.y=8*o.gotoy,4==o.type&&(pe=!0),n}return-1}var we=0;var Se=0;var Te=0;var Ae=0;var ke=1,Re={};var Ee=0,Me=0;var Pe=0,Le=0,Ie=0,Ce=0,Be=0,Ge=0,je=0,De=0;var Ue=function(){function e(t){d(this,e),this.prev_pnode=null,this.prev_gap=0,this.prev_height=0,this.prev_end=0,this.branch=null,this.branch_height=0,this.ptype=t,this.next_pnode=null,this.next_gap=0,this.next_height=0,this.next_end=0}return o(e,[{key:"setPrev",value:function(t,e,i){this.prev_pnode=t,this.prev_gap=e,this.prev_height=i,t.next_pnode=this,t.next_gap=e,t.next_height=-1*i}},{key:"setBranch",value:function(t,e){var i=1<arguments.length&&void 0!==e?e:0;this.branch=t,this.branch_height=i,t.branch=this,t.branch_height=-1*i}},{key:"setNext",value:function(t,e,i){var r=1<arguments.length&&void 0!==e?e:0,n=2<arguments.length&&void 0!==i?i:0;this.next_pnode=t,this.next_gap=r,this.next_height=n,t.prev_pnode=this,t.prev_gap=r,t.prev_height=-1*n}},{key:"hasPrev",value:function(){return!!this.prev_pnode}},{key:"hasBranch",value:function(){return!!this.branch}},{key:"hasNext",value:function(){return!!this.next_pnode}},{key:"getPrev",value:function(){return this.prev_node?this.prev_node.print():{}}},{key:"getBranch",value:function(){return this.branch?this.branch.print():{}}},{key:"getNext",value:function(){return this.next_node?this.next_node.print():{}}},{key:"detach",value:function(){this.hasPrev()&&(this.prev_pnode.next_pnode=null,this.prev_pnode.next_height=0,this.prev_pnode.next_gap=0),this.hasNext()&&(this.next_pnode.prev_pnode=null,this.next_pnode.prev_height=0,this.next_pnode.prev_gap=0),this.hasBranch()&&(this.branch.branch=null,this.branch.branch_height=0),this.prev_pnode=null,this.prev_gap=0,this.prev_height=0,this.branch=null,this.next_pnode=null,this.next_gap=0,this.next_height=0}},{key:"info",value:function(){return{prev_node:this.hasPrev(),prev_gap:this.prev_gap,prev_height:this.prev_height,branch:this.hasBranch(),ptype:this.ptype,x:this.x,y:this.y,next_node:this.hasNext(),next_gap:this.next_gap,next_height:this.next_height,next_end:this.next_end}}}]),e}(),Fe=0,Oe=-1,Ne=function(){function p(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;d(this,p),this.finalArea=t-1,this.numAreas=t+e,this.sidePaths=e,this.AdjList=new Map,this.init_terrain_type="",this.areas=[];for(var i=0;i<t;i++)this.addArea(i);for(var r=0,n=1;r<t-1;r++,n++)this.connect(r,n);for(var o=Array.from(Array(t-2).keys(),function(t){return t+1}),s=t;s<this.numAreas;){var a=o[R(0,o.length)];o.push(s),this.addArea(s),this.connect(a,s),s++}var h,u=[],l=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=f(t))){var e=0,i=function(){};return{s:i,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,n,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,n=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw n}}}}(this.AdjList.keys());try{for(l.s();!(h=l.n()).done;){var c=h.value;c>this.finalArea&&1===this.AdjList.get(c).length&&u.push(c)}}catch(t){l.e(t)}finally{l.f()}this.leaves=u}return o(p,[{key:"addArea",value:function(t){this.AdjList.set(t,[])}},{key:"connect",value:function(t,e){this.AdjList.get(t).push(e),this.AdjList.get(e).push(t)}},{key:"info",value:function(){return"\nmain path length: "+(this.finalArea+1)+"   num other areas: "+this.sidePaths+"\nleaves:  "+this.leaves+"   start: [0]  end: ["+this.finalArea+"]\n CURRENT AREA: "+Fe+"\nwidth: "+this.areas[Fe].width+"  leaves: "+this.areas[Fe].exits}},{key:"area_info",value:function(t){for(var e=this.areas[t].exits,i="",r="",n=0,o=Object.keys(e);n<o.length;n++){var s=o[n];switch(e[s].type){case 4:r="door";break;case 10:r="left  <";break;case 11:r="right >";break;case 12:r="down  v";break;case 13:r="up    ^"}i+=s+": "+r+"\n"}return i+="width: "+this.areas[t].width,i+="  height: "+this.areas[t].height,i+="\nterrain: "+this.areas[t].terrain}},{key:"shuffleArray",value:function(t){for(var e=t.length;0!==e;){var i=R(0,e),r=t[--e];t[e]=t[i],t[i]=r}return t}},{key:"build_area",value:function(a,t,e){for(var h=this,u=1<arguments.length&&void 0!==t?t:1,l=2<arguments.length&&void 0!==e?e:1,i=w(Array(32*l)).map(function(t){return Array(32*u).fill(0)}),r=w(Array(32*l)).map(function(t){return Array(32*u).fill(0)}),n=new Ve(32*u,32*l),o=new Ve(32*u,32*l),s=new Ve(32*u,32*l),c=this.AdjList.get(a),p=c[0],f=this.shuffleArray([11,11,11,10,12,13,4]),d="",g={},v=0;v<c.length;v++)if(0==a)!function(){var e=4;0<f.length&&(e=f.pop(),f=f.filter(function(t){return t!=e}));var t=-1,i=-1,r=0,n=0;switch(i=t=-1,e){case 4:r=32*u-(t=5),n=32*l-2;break;case 10:r=0,n=32*l-2;break;case 11:t=0,r=32*u-1,n=32*l-2;break;case 12:i=0,r=Math.floor(32*u/2),n=32*l-1;break;case 13:r=Math.floor(32*u/2),n=0}g[1]={goto:1,gx:r,gy:n,gotox:t,gotoy:i,type:e,status:0,open_images:[234,235,218,219,202,203],images:[234,235,218,219,202,203]},d=h.init_terrain_type}();else if(a==this.finalArea)!function(){var t=h.areas[p].exits[a],e=t.type,i=-1,r=0,n=0;switch(e){case 4:i=4,r=5,n=32*l-2;break;case 10:i=11,r=32*u-1,n=32*l-2;break;case 11:i=10,r=0,n=32*l-2;break;case 12:i=13,r=Math.floor(32*u/2),n=0;break;case 13:i=12,r=Math.floor(32*u/2),n=32*l-1}f=f.filter(function(t){return t!=i}),t.gotox=r,t.gotoy=n,h.areas[p].exits[a]=t,g[p]={goto:p,gx:r,gy:n,gotox:t.gx,gotoy:t.gy,type:i,status:0,open_images:[234,235,218,219,202,203],images:[234,235,218,219,202,203]};var o=h.areas[p].terrain,s=E[o][e.toString()];d=s[R(0,s.length)]}();else if(0==v)!function(){var t=h.areas[p].exits[a],e=t.type,i=-1,r=0,n=0;switch(e){case 4:i=4,r=5,n=32*l-2;break;case 10:i=11,r=32*u-1,n=32*l-2;break;case 11:i=10,r=0,n=32*l-2;break;case 12:i=13,r=Math.floor(32*u/2),n=0;break;case 13:i=12,r=Math.floor(32*u/2),n=32*l-1}f=f.filter(function(t){return t!=i}),t.gotox=r,t.gotoy=n,h.areas[p].exits[a]=t,g[p]={goto:p,gx:r,gy:n,gotox:t.gx,gotoy:t.gy,type:i,status:0,open_images:[234,235,218,219,202,203],images:[234,235,218,219,202,203]};var o=E[h.areas[p].terrain][e.toString()];d=o[R(0,o.length)]}();else{var y=c[v];(y<=this.finalArea?function(){var e=4;0<f.length&&(e=f.pop(),f=f.filter(function(t){return t!=e}));var t=0,i=0,r=0,n=0;switch(i=t=-1,e){case 4:r=32*u-y-(t=5),n=32*l-2;break;case 10:r=0,n=32*l-2;break;case 11:t=0,r=32*u-1,n=32*l-2;break;case 12:i=0,r=Math.floor(32*u/2),n=32*l-1;break;case 13:r=Math.floor(32*u/2),n=0}g[y]={goto:y,gx:r,gy:n,gotox:t,gotoy:i,type:e,status:0,open_images:[234,235,218,219,202,203],images:[234,235,218,219,202,203]}}:function(){var e=4;0<f.length&&(e=f.pop(),f=f.filter(function(t){return t!=e}));var t=0,i=0,r=0,n=0;switch(i=t=-1,e){case 4:r=32*u-y-(t=5),n=32*l-2;break;case 10:r=0,n=32*l-2;break;case 11:t=0,r=32*u-1,n=32*l-2;break;case 12:i=0,r=Math.floor(32*u/2),n=32*l-1;break;case 13:r=Math.floor(32*u/2),n=0}g[y]={goto:y,gx:r,gy:n,gotox:t,gotoy:i,type:e,status:0,open_images:[234,235,218,219,202,203],images:[234,235,218,219,202,203]}})()}for(var m=0,_=Object.keys(g);m<_.length;m++){var x=_[m];r[g[x].gy][g[x].gx]=g[x].type}var b={grid:i,event_grid:r,image:n,image_behind:o,image_front:s,exits:g,width:32*u,height:32*l,xscreens:u,yscreens:l,terrain:d};this.areas.splice(a,1,b)}},{key:"makeAreaDungeon",value:function(t){for(var e=this.areas[t],i=0;i<e.height;i++)for(var r=0;r<e.width;r++)0==e.grid[i][r]&&e.image.set(r,i,241)}},{key:"moveExit",value:function(){}},{key:"testPlaceTerrain",value:function(t){for(var e=this.areas[t],i=e.height+2,r=e.width+2,n=e.height-1,o=e.height,s=w(Array(i)).map(function(t){return Array(r).fill(0)}),a=0;a<r;a++)s[0][a]=49,s[i-1][a]=17;for(var h=0;h<i;h++)s[h][0]=34,s[h][r-1]=32;s[0][0]=25,s[0][r-1]=27,s[i-1][0]=57,s[i-1][r-1]=59;for(var u=1;u<r;u++)Math.abs(Math.floor(r/2)-u)<2||(this.dot_(s,u,o),e.grid[n][u-1]=1);return this.dot_(s,1,o),e.grid[n][0]=1,this.placeStructure(s,e,-1,-1,1),s}},{key:"testPlaceClimbObjects",value:function(t){tilesheet(g);for(var e=this.areas[t],i=e.height,r=e.width,n=0;n<i;n++){var o=Math.floor(r/2);e.grid[n][o]=2,e.image.set(o,n,8)}}},{key:"testPlacePlatforms",value:function(t){for(var e=this.areas[t],i=new Ue(240),r=i,n=0;n<20;n++){var o=new Ue(240+n%2),s=R(1,7),a=R(-2,3);r.setNext(o,s,a),r=o}for(var h=i,u=3,l=16;h.hasNext();)u<e.width&&l<e.height?(e.grid[l][u]<=9&&(e.grid[l][u]=1),e.image.set(u,l,h.ptype)):console.log("oob! "+u+" "+l),u+=h.next_gap,l+=h.next_height,h=h.next_pnode}},{key:"build_areas",value:function(t){var e=0<arguments.length&&void 0!==t?t:"ground";this.init_terrain_type=e;for(var i=0;i<this.numAreas;i++){var r=R(1,4),n=R(1,2);this.build_area(i,r,n),this.testPlaceTerrain(i),this.testScatter(i),this.testPlaceClimbObjects(i)}}},{key:"placeStructure",value:function(t,e,i,r,n,o){for(var s=64*(4<arguments.length&&void 0!==n?n:0),a=e[5<arguments.length&&void 0!==o?o:"image"],h=0;h<t.length&&r+h<e.height;h++)for(var u=0;u<t[0].length&&i+u<e.width;u++)0<t[h][u]&&0<=r+h&&0<=i+u&&a.set(i+u,r+h,t[h][u]+s)}},{key:"testScatter",value:function(t){var e=this.areas[t],i=w(Array(30)).map(function(t){return Array(30).fill(0)});this.dot_(i,1,4),this.dot_(i,4,5),this.dot_(i,4,6),this.dot_(i,5,6),this.dot_(i,5,5),this.dot_(i,6,6),this.dot_(i,6,7);var r=w(Array(7)).map(function(t){return Array(7).fill(0)});this.dot_(r,3,1),this.dot_(r,2,2),this.dot_(r,3,2),this.dot_(r,4,2),this.dot_(r,1,3),this.dot_(r,2,3),this.dot_(r,3,3),this.dot_(r,4,3),this.dot_(r,5,3),this.dot_(r,2,4),this.dot_(r,3,4),this.dot_(r,4,4),this.dot_(r,3,5);for(var n=w(Array(30)).map(function(t){return Array(30).fill(0)}),o=w(Array(30)).map(function(t){return Array(30).fill(0)}),s=0,a=0,h=0;h<200;h++)s=R(1,20),a=R(1,20),this.dot_(i,s,a);for(var u=0;u<600;u++)s=R(1,20),a=R(1,20),this.dot_(n,s,a);for(var l=0;l<300;l++)s=R(1,20),a=R(1,20),this.dot_(o,s,a);this.placeStructure(o,e,5,5,0,"image_front"),this.placeStructure(n,e,5,5,2,"image_behind")}},{key:"dot_",value:function(t,e,i){var r=t.length,n=t[0].length;if(!(e<=0||n-1<=e||i<=0||r-1<=i)){var o=1,s=t[i][e];if(!s){var a=t[i-1][e-1],h=$e.tl[a.toString()],u=t[i-1][e+1],l=$e.tr[u.toString()],c=t[i+1][e-1],p=$e.bl[c.toString()],f=t[i+1][e+1],d=$e.br[f.toString()],g=t[i-1][e];g&&(o*=2);var v=0,y=t[i][e-1];y&&(o*=3);var m=0,_=t[i+1][e];_&&(o*=5);var x=0,b=t[i][e+1];b&&(o*=7);var w=0,S=39,T=1;switch(o){case 210:switch(d&&(t[i+1][e+1]=d,T*=2),p&&(t[i+1][e-1]=p,T*=3),l&&(t[i-1][e+1]=l,T*=5),h&&(t[i-1][e-1]=h,T*=7),T){case 210:m=$e.l_m30[y.toString()],w=$e.r_m70[b.toString()],x=$e.b_m105[_.toString()],v=$e.t_m42[g.toString()],S=33;break;case 105:v=$e.t_m42[g.toString()],w=$e.r_m14[b.toString()],m=$e.l_m30[y.toString()],x=$e.b_m15[_.toString()],S=25;break;case 70:w=$e.r_m70[b.toString()],x=$e.b_m35[_.toString()],v=$e.t_m42[g.toString()],m=$e.l_m6[y.toString()],S=27;break;case 42:w=$e.r_m35[b.toString()],x=$e.b_m105[_.toString()],m=$e.l_m30[y.toString()],v=$e.t_m6[g.toString()],S=57;break;case 30:v=$e.t_m14[g.toString()],w=$e.r_m70[b.toString()],m=$e.l_m15[y.toString()],x=$e.b_m105[_.toString()],S=59;break;case 35:v=$e.t_m42[g.toString()],m=$e.l_m6[y.toString()],w=$e.r_m14[b.toString()],x=$e.b_[_.toString()],S=52;break;case 21:v=$e.t_m6[g.toString()],m=$e.l_m30[y.toString()],x=$e.b_m15[_.toString()],w=$e._r[b.toString()],S=37;break;case 15:v=$e.t_m14[g.toString()],w=$e.r_m14[b.toString()],m=$e.l_m15[y.toString()],x=$e.b_m15[_.toString()],S=61;break;case 14:v=$e.t_m6[g.toString()],m=$e.l_m6[y.toString()],w=$e.r_m35[b.toString()],x=$e.b_m35[_.toString()],S=60;break;case 10:v=$e.t_m14[g.toString()],w=$e.r_m70[b.toString()],x=$e.b_m35[_.toString()],m=$e._l[y.toString()],S=35;break;case 6:m=$e.l_m15[y.toString()],w=$e.r_m35[b.toString()],x=$e.b_m105[_.toString()],v=$e.t_[g.toString()],S=20;break;case 7:m=$e.l_m6[y.toString()],w=$e._r[b.toString()],x=$e.b_[_.toString()],v=$e.t_m6[g.toString()],S=53;break;case 5:m=$e._l[y.toString()],w=$e.r_m14[b.toString()],x=$e.b_[_.toString()],v=$e.t_m14[g.toString()],S=51;break;case 3:m=$e.l_m15[y.toString()],w=$e._r[b.toString()],x=$e.b_m15[_.toString()],v=$e.t_[g.toString()],S=21;break;case 2:m=$e._l[y.toString()],w=$e.r_m35[b.toString()],x=$e.b_m35[_.toString()],v=$e.t_[g.toString()],S=19;break;case 1:m=$e._l[y.toString()],w=$e._r[b.toString()],x=$e.b_[_.toString()],v=$e.t_[g.toString()],S=42}t[i][e+1]=w,t[i][e-1]=m,t[i-1][e]=v,t[i+1][e]=x;break;case 105:switch(d&&(t[i+1][e+1]=d,T*=2),p&&(t[i+1][e-1]=p,T*=3),T){case 6:m=$e.l_m15[y.toString()],w=$e.r_m35[b.toString()],x=$e.b_m105[_.toString()],S=17;break;case 3:m=$e.l_m15[y.toString()],x=$e.b_m15[_.toString()],w=$e._r[b.toString()],S=29;break;case 2:m=$e._l[y.toString()],w=$e.r_m35[b.toString()],x=$e.b_m35[_.toString()],S=30;break;case 1:m=$e._l[y.toString()],w=$e._r[b.toString()],x=$e.b_[_.toString()],S=55}t[i][e+1]=w,t[i][e-1]=m,t[i+1][e]=x;break;case 70:switch(d&&(t[i+1][e+1]=d,T*=2),l&&(t[i-1][e+1]=l,T*=3),T){case 6:v=$e.t_m14[g.toString()],w=$e.r_m70[b.toString()],x=$e.b_m35[_.toString()],S=32;break;case 3:v=$e.t_m14[g.toString()],w=$e.r_m14[b.toString()],x=$e.b_[_.toString()],S=46;break;case 2:v=$e.t_[g.toString()],w=$e.r_m35[b.toString()],x=$e.b_m35[_.toString()],S=28;break;case 1:v=$e.t_[g.toString()],w=$e._r[b.toString()],x=$e.b_[_.toString()],S=40}t[i-1][e]=v,t[i][e+1]=w,t[i+1][e]=x;break;case 42:switch(l&&(t[i-1][e+1]=l,T*=2),h&&(t[i-1][e-1]=h,T*=3),T){case 6:v=$e.t_m42[g.toString()],m=$e.l_m6[y.toString()],w=$e.r_m14[b.toString()],S=49;break;case 3:v=$e.t_m6[g.toString()],m=$e.l_m6[y.toString()],w=$e._r[b.toString()],S=47;break;case 2:v=$e.t_m14[g.toString()],m=$e._l[y.toString()],w=$e.r_m14[b.toString()],S=44;break;case 1:v=$e.t_[g.toString()],m=$e._l[y.toString()],w=$e._r[b.toString()],S=23}t[i-1][e]=v,t[i][e-1]=m,t[i][e+1]=w;break;case 30:switch(p&&(t[i+1][e-1]=p,T*=2),h&&(t[i-1][e-1]=h,T*=3),T){case 6:v=$e.t_m6[g.toString()],m=$e.l_m30[y.toString()],x=$e.b_m15[_.toString()],S=34;break;case 3:v=$e.t_m6[g.toString()],m=$e.l_m6[y.toString()],x=$e.b_[_.toString()],S=45;break;case 2:v=$e.t_[g.toString()],m=$e.l_m15[y.toString()],x=$e.b_m15[_.toString()],S=31;break;case 1:v=$e.t_[g.toString()],m=$e._l[y.toString()],x=$e.b_[_.toString()],S=38}t[i-1][e]=v,t[i][e-1]=m,t[i+1][e]=x;break;case 35:S=d?(w=$e.r_m35[b.toString()],x=$e.b_m35[_.toString()],t[i+1][e+1]=d,16):(w=$e._r[b.toString()],x=$e.b_[_.toString()],22),t[i+1][e]=x,t[i][e+1]=w;break;case 15:S=p?(m=$e.l_m15[y.toString()],x=$e.b_m15[_.toString()],t[i+1][e-1]=p,18):(m=$e._l[y.toString()],x=$e.b_[_.toString()],24),t[i+1][e]=x,t[i][e-1]=m;break;case 14:S=l?(v=$e.t_m14[g.toString()],w=$e.r_m14[b.toString()],t[i-1][e+1]=l,48):(v=$e.t_[g.toString()],w=$e._r[b.toString()],54),t[i-1][e]=v,t[i][e+1]=w;break;case 6:S=h?(v=$e.t_m6[g.toString()],m=$e.l_m6[y.toString()],t[i-1][e-1]=h,50):(v=$e.t_[g.toString()],m=$e._l[y.toString()],56),t[i-1][e]=v,t[i][e-1]=m;break;case 21:w=$e._r[b.toString()],t[i][e+1]=w,m=$e._l[y.toString()],t[i][e-1]=m,S=62;break;case 10:x=$e.b_[_.toString()],t[i+1][e]=x,v=$e.t_[g.toString()],t[i-1][e]=v,S=63;break;case 7:w=$e._r[b.toString()],t[i][e+1]=w,S=41;break;case 5:x=$e.b_[_.toString()],t[i+1][e]=x,S=26;break;case 3:m=$e._l[y.toString()],t[i][e-1]=m,S=43;break;case 2:v=$e.t_[g.toString()],t[i-1][e]=v,S=58}s||(t[i][e]=S)}}}}]),p}(),$e={t_:{0:0,23:42,39:26,41:22,43:24,44:51,47:53,48:46,49:52,50:45,54:40,56:38,58:63,62:55},t_m6:{0:0,23:21,43:18,44:61,47:37,49:25,50:34,56:31,62:29},t_m14:{0:0,23:19,41:16,47:60,44:35,48:32,49:27,54:28,62:30},t_m42:{0:0,23:20,39:20,47:57,44:59,49:33,62:17},_l:{0:0,18:29,24:55,26:22,31:21,34:37,38:42,39:41,43:62,45:53,50:47,56:23,58:54,63:40},l_m6:{0:0,31:61,34:25,38:51,45:52,50:49,56:44,58:48,63:46},l_m15:{0:0,18:17,24:30,26:16,31:20,34:57,38:19,45:60,63:28},l_m30:{0:0,31:59,34:33,38:35,45:27,63:32},b_:{0:0,16:28,17:20,18:31,22:40,24:38,26:63,29:21,30:19,39:58,41:54,43:56,55:42,62:23},b_m15:{0:0,17:57,18:34,24:45,29:37,30:60,43:50,55:53,62:47},b_m35:{0:0,16:32,17:59,22:46,29:61,30:35,41:48,55:51,62:44},b_m105:{0:0,17:33,29:25,30:27,55:52,62:49},_r:{0:0,16:30,22:55,26:24,28:19,32:35,39:43,40:42,41:62,46:51,48:44,54:23,58:56,63:38},r_m14:{0:0,28:60,32:27,40:53,46:52,48:49,54:47,58:50,63:45},r_m35:{0:0,16:17,22:29,26:18,28:20,32:59,40:21,46:61,63:31},r_m70:{0:0,28:57,32:33,40:37,46:25,63:34},tl:{0:0,21:20,22:16,25:33,29:17,37:57,40:28,42:19,46:32,51:35,52:27,53:60,55:30,61:59},tr:{0:0,19:20,24:18,27:33,30:17,35:59,38:31,42:21,45:34,51:61,52:25,53:37,55:29,60:57},bl:{0:0,19:35,20:59,21:61,23:44,28:32,37:25,40:46,42:51,47:49,53:52,54:48,57:33,60:27},br:{0:0,19:60,20:57,21:37,23:47,31:34,35:27,38:45,42:53,44:49,51:52,56:50,59:33,61:25},oob_bottom:{0:0,55:17,22:16,24:18},oob_bl_corner:{0:0,55:17,22:17,24:17},oob_br_corner:{0:0,55:17,22:17,24:17}};tilesheet(p);var Ve=t("pixelbox/TileMap"),ze=new Ne(3,7);ze.build_areas();var He=ze.areas[Fe],Xe=He.image,qe=He.image_behind,We=He.image_front,Ye=He.grid,Qe=He.event_grid,Ze=He.width,Je=He.height,Ke=8*Ze,ti=8*Je;var ei=0,ii=0,ri=0;function ni(){-1<Oe&&(ue?function(t){if(-1<t){var i=He.exits[t];0===i.status?pe&&(assets.bleeper.enter_area.play(),Re=i,pe=!1):1==i.status?(i.images.forEach(function(t,e){i.images[e]=i.open_images[e]}),pe&&(i.status=0,assets.bleeper.door_open.play(),pe=!1)):2==i.status&&(ke?(i.images.forEach(function(t,e){i.images[e]=i.open_images[e]+2}),pe&&(i.status=1,ke--,assets.bleeper.door_unlock.play(),pe=!1)):pe&&(assets.bleeper.unlock_fail.play(),pe=!1))}}(Oe):(He=ze.areas[Oe],Fe=Oe,Xe=He.image,qe=He.image_behind,We=He.image_front,Ye=He.grid,Qe=He.event_grid,Ze=He.width,Je=He.height,Ke=8*Ze,ti=8*Je,Oe=-1)),function(){for(var t=0;t<z.length;t++){var e=z[t];e.x+=e.vx[e.vframe],e.y+=e.vy[e.vframe],e.vframe+=1,e.vframe>=e.vx.length&&(e.vframe=0)}}(),ge(),xe(),pt?(G=M(P[L].idle),btn.R||btn.L?(G=M(P[L].run),jt=xt[wt],++wt>=xt.length&&(wt=0)):(jt=vt[mt],++mt>=vt.length&&(mt=0)),Pt&&(G=M(P[L].skid),jt=It[Bt])):(G=M(P[L].fall),jt=0),Ut&&(G=M(P[L].jump),jt=0),se&&(G=M(P[L].climb),he>=ae.length&&(he=0),jt=ae[he]),Tt&&(G=M(P[L].shoot),jt=kt[Et]),ue&&(G=M(P[L].door),jt=le[ce]),ft?(j=M(P[I].idle),btn.R2||btn.L2?(j=M(P[I].run),Dt=bt[St],++St>=bt.length&&(St=0)):(Dt=yt[_t],++_t>=yt.length&&(_t=0)),Lt&&(j=M(P[I].skid),Dt=Ct[Gt])):(j=M(P[I].fall),Dt=0),Ft&&(j=M(P[I].jump),Dt=0),At&&(j=M(P[I].shoot),Dt=Rt[Mt]),function(){for(var t=0;t<F.length;t++){var e=F[t];e.x+=e.vx,e.y+=e.vy,e.frame<e.frames.length-1?e.frame+=1:e.alive=!1}F=F.filter(function(t){return t.alive});for(var i=0;i<N.length;i++){var r=N[i];r.x+=r.vx,r.y+=r.vy,r.frame<r.frames.length-1?r.frame+=1:r.alive=!1}N=N.filter(function(t){return t.alive})}(),function(){for(var t=0;t<H.length;t++){var e=H[t];if(!(!e.in_screen||e.x-C.x>s||e.x-C.x<-s))if(e.alive){if(e.going_left)if(1==J(q(e.x-e.vx[e.vxframe]),e.y)){if(e.stuck_in_block){e.alive=!1,e.vxframe=0;continue}e.x=et(e.x),e.going_left=!1,e.stuck_in_block=!0}else e.x-=e.vx[e.vxframe],e.stuck_in_block=!1;else if(1==J(X(e.x+e.vx[e.vxframe]),e.y)){if(e.stuck_in_block){e.alive=!1,e.vxframe=0;continue}e.x=tt(e.x),e.going_left=!0,e.stuck_in_block=!0}else e.x+=e.vx[e.vxframe],e.stuck_in_block=!1;e.vxframe++,e.vxframe>=e.vx.length&&(e.vxframe=0),e.grounded?"walkbump"==e.move_type||"steadyjump"==e.move_type&&"steady"==e.move_phase?J(e.x,W(e.y))<=0&&J(e.x+7,W(e.y))<=0&&(e.vyframe=0,e.fallframe=0,e.grounded=!1):"steadyjump"==e.move_type&&"upjump"==e.move_phase?(st=Y(e.y+e.vy[e.vyframe]),1==J(e.x,st)||1==J(e.x+7,st)?(e.vyframe=0,e.vxframe=0,e.y=rt(e.y),e.grounded=!1,e.move_phase="steady"):e.y+=e.vy[e.vyframe]):"steadyjump"==e.move_type&&"downjump"==e.move_phase&&(nt=W(e.y+e.vy[e.vyframe]),1==J(e.x,nt)||1==J(e.x+7,nt)?(e.vyframe=0,e.vxframe=0,e.y=it(e.y),e.grounded=!0,e.move_phase="steady"):e.y+=e.vy[e.vyframe]):(nt=W(e.y+e.fall[e.fallframe]),1==J(e.x,nt)||1==J(e.x+7,nt)?(e.y=it(e.y),e.grounded=!0):e.y+=e.fall[e.fallframe]),e.vyframe++,e.vyframe>=e.vy.length&&(e.vyframe=0),"steadyjump"==e.move_type&&(e.vyframe<60?e.move_phase="steady":60<=e.vyframe&&e.vyframe<90?e.move_phase="upjump":90<=e.vyframe&&e.vyframe<120&&(e.move_phase="downjump")),e.fallframe<e.fall.length-1&&e.fallframe++,e.frame++,e.frame>=e.frames.length&&(e.frame=0),Te=F.length+" ";for(var i=0;i<F.length;i++)e.alive&&Math.abs(F[i].x-e.x)<4&&Math.abs(F[i].y-e.y)<4&&(F[i].alive=!1,assets.bleeper.hit.play(),Te="hit!",--e.HP,e.HP<=0&&(Te="kill!",e.alive=!1,e.SCORE,li()))}else e.dead_frames++}H=H.filter(function(t){return t.dead_frames<60})}(),cls(),32<He.width?(De=0==ve?(Ie=1,je=-6,-32):je=Ie=0,0==ye?Ce=1:(Ce=0,je=Math.floor((Ke-h)/20)-6,De=Math.floor((Ke-h)/4)-32)):De=je=Ce=Ie=0,Ge=32<He.height?(Be=0==me?1:0,0==_e?1:0):Be=0,Pe=Math.floor(C.x/20)*Ie*Ce+je,draw(l,0-fe-Pe,12),draw(l,0-Pe,12),draw(l,0+fe-Pe,12),draw(l,0+2*fe-Pe,12),Le=Math.floor(C.x/4)*Ie*Ce+De,draw(c,0-fe-Le,12),draw(c,0-Le,12),draw(c,0+fe-Le,12),draw(c,0+2*fe-Le,12),Ke==s?ei=0:(ei=0==ve?s-h:0,0==ye||(ei=-(Ke-s))),ti==a?ii=0:(ii=0==me?a-u:0,0==_e||(ii=-(ti-a))),tilesheet(g),draw(qe,ei-C.x*Ie*Ce,ii-C.y*Be*Ge-ri),draw(Xe,ei-C.x*Ie*Ce,ii-C.y*Be*Ge-ri),tilesheet(p),function(){var t=He.exits;32<He.width?(Ee=0==ve?s-h:0,0==ye||(Ee=-(Ke-s))):Ee=0,32<He.height?(Me=0==me?a-u:0,0==_e||(Me=-(ti-a))):Me=0;for(var e=0,i=Object.keys(t);e<i.length;e++){var r=t[i[e]];4==r.type&&(sprite(r.images[0],8*r.gx+Ee-C.x*Ie*Ce,8*r.gy+Me-C.y*Be*Ge-ri,!1),sprite(r.images[1],8*r.gx+Ee+8-C.x*Ie*Ce,8*r.gy+Me-C.y*Be*Ge-ri,!1),sprite(r.images[2],8*r.gx+Ee-C.x*Ie*Ce,8*r.gy+Me-8-C.y*Be*Ge-ri,!1),sprite(r.images[3],8*r.gx+Ee+8-C.x*Ie*Ce,8*r.gy+Me-8-C.y*Be*Ge-ri,!1),sprite(r.images[4],8*r.gx+Ee-C.x*Ie*Ce,8*r.gy+Me-16-C.y*Be*Ge-ri,!1),sprite(r.images[5],8*r.gx+Ee+8-C.x*Ie*Ce,8*r.gy+Me-16-C.y*Be*Ge-ri,!1))}}(),function(){Se=0==ve?s-h:0,0==ye||(Se=-(Ke-s));for(var t=0;t<z.length;t++){var e=z[t];sprite(e.image+e.frames[e.frame],e.x+Se-C.x*Ie*Ce,e.y+u-C.y*Be*Ge)}}(),tilesheet(y),function(){Ae=0==ve?s-h:0,0==ye||(Ae=-(Ke-s));for(var t=0;t<H.length;t++){var e=H[t];e.dead_frames%2==0&&(e.dead_frame=4==e.dead_frame?8:4),sprite(e.image+e.frames[e.frame]+e.dead_frame,e.x+Ae-C.x*Ie*Ce,e.y+u-C.y,e.going_left)}}(),tilesheet(v),sprite(j[0]+2*Dt,ei+B.x-4+8*U-C.x*Ie*Ce,ii+B.y-16-C.y*Be*Ge-ri,U),sprite(j[1]+2*Dt,ei+B.x+8-4-8*U-C.x*Ie*Ce,ii+B.y-16-C.y*Be*Ge-ri,U),sprite(j[2]+2*Dt,ei+B.x-4+8*U-C.x*Ie*Ce,ii+B.y+8-16-C.y*Be*Ge-ri,U),sprite(j[3]+2*Dt,ei+B.x+8-4-8*U-C.x*Ie*Ce,ii+B.y+8-16-C.y*Be*Ge-ri,U),sprite(j[4]+2*Dt,ei+B.x-4+8*U-C.x*Ie*Ce,ii+B.y+16-16-C.y*Be*Ge-ri,U),sprite(j[5]+2*Dt,ei+B.x+8-4-8*U-C.x*Ie*Ce,ii+B.y+16-16-C.y*Be*Ge-ri,U),tilesheet(p),sprite(G[0]+2*jt,h-ve-4+8*D+ye,u-me-16+_e-ri,D),sprite(G[1]+2*jt,h-ve+8-4-8*D+ye,u-me-16+_e-ri,D),sprite(G[2]+2*jt,h-ve-4+8*D+ye,u-me+8-16+_e-ri,D),sprite(G[3]+2*jt,h-ve+8-4-8*D+ye,u-me+8-16+_e-ri,D),sprite(G[4]+2*jt,h-ve-4+8*D+ye,u-me+16-16+_e-ri,D),sprite(G[5]+2*jt,h-ve+8-4-8*D+ye,u-me+16-16+_e-ri,D),tilesheet(g),draw(We,ei-C.x*Ie*Ce,ii-C.y*Be*Ge-ri),function(){we=0==ve?s-h:h,0==ye||(we=-(Ke-s));for(var t=0;t<F.length;t++){var e=F[t];sprite(e.image+e.frames[e.frame],e.x+we-C.x,e.y+u-C.y)}for(var i=0;i<N.length;i++){var r=N[i];sprite(r.image+r.frames[r.frame],r.x+we-C.x*Ie*Ce,r.y+u-C.y)}}(),de&&draw(_[x[b]],16,16),function(){0;0;var t=Fe==ze.finalArea?" BOSS ":Fe;print("area: "+t,8,0),print(ze.area_info(Fe),0,16),0}();var t=Date.now();ui=Math.round(1e3/(t-hi)),hi=t,btn.gs2?(ai=1,print("x2 speed",64,8)):btn.gs1&&(ai=2,print("x1 speed",64,8))}console.log(ze.info());var oi=0,si=0,ai=2,hi=1,ui=0;function li(){180<oi-Z&&(Q=0),Z=oi;var t=1;return 4<=++Q&&(t=2),10<=Q&&(t=3),t}var ci="level";i.update=function(){if(ai<=++si)switch(si=0,oi++,ci){case"title":tilesheet(m),oi%60==0&&(draw(S,0,a-64),sprite(0+Math.floor(oi/60),0+8*Math.floor(oi/60),128)),2e3<=oi&&(ci="level");break;case"scene":case"world":break;case"level":ni()}}},{"./platforms.js":43,"pixelbox/TileMap":18}],43:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.platforms=void 0;i.platforms=[{image:226,x:2,y:2,vx:[0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,-2],vy:[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,-1],vframe:0,frame:0,frames:[0,1,2,3,4],alive:!0},{image:226,x:2,y:2,vx:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,-1],vy:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],vframe:0,frame:0,frames:[0,1,2,3,4],alive:!0},{image:226,x:2,y:2,vx:[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],vy:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],vframe:0,frame:0,frames:[0,1,2,3,4],alive:!0},{image:226,x:2,y:2,vx:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],vy:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,-1,0,0,0,-1,0,0,0,-1,0,0,0],vframe:0,frame:0,frames:[0,1,2,3,4],alive:!0},{image:226,x:2,y:2,vx:[1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,-1,0,-1,0,-1,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vy:[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,-1,0,-1,0,-1,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0,-1,0,0,0,0,0,0,0],vframe:0,frame:0,frames:[0,1,2,3,4],alive:!0}]},{}],44:[function(d,t,e){"use strict";var i,r,c=d("."),n={dat:{info_bar:null,items:null,palette:null,tilesheet:null,tilesheet2:null,tilesheet_enemies:null,tilesheet_mountain:null,tilesheet_terrain:null,tilesheet_worldmap:null,bleeper:{_type:"Bleeper program",v:1,s:[{n:"jump",i:[7,51,111,0],s:"(KF(HF(CF(?F(8D(Y@(Z<(]:(_9(b7(h5(q30$-"},{n:"bonk",i:[8,18,76,0],s:"(}U(qU(dU(JU(8U()U(#U"},{n:"bump",i:[5,34,82,0],s:"'u8'i4'Y1'K~';,(%+(%*(&+(0~(D1(X4&i&"},{n:"urch",i:[12,51,98,0],s:"'bU*>#'bU*t#*a#*|#*<#(pU"},{n:"land",i:[4,42,95,0],s:"(1S*4#'}-"},{n:"shoot2",i:[11,61,117,0],s:"&3/*m2*a0*U-*E(*9&*)$*'#*'#"},{n:"shoot",i:[10,53,116,0],s:"&E)(X7(E=(6C"},{n:"hit",i:[11,13,127,0],s:"*IH*_M*c#(eU"},{n:"climb",i:[10,64,93,0],s:"(89(89(Q9(Q9(z9(z9"},{n:"door_unlock",i:[13,48,127,0],s:"*TA*T=*T/*a#*R#*eQ*eK*eC*e=*e7*e1'r,'r+'r)'r''r&'r&'r&'r&'r%'r$'r$'r$'r$'r$"},{n:"door_open",i:[13,72,100,0],s:"*rQ*rL*rB*r<*r4*r-*r'*r$*e#*k6*k0*j**i&*i&*i&*l&*n$*p$*r$*t$"},{n:"unlock_fail",i:[15,39,92,0],s:"*e6*e6&%(&$%&#$*}#&[#*e7*e6&%(&$&&#%"},{n:"correct",i:[33,43,98,0],s:"'P1'P)'P1'P)'X1'X)'i1'i%'i$'i$"},{n:"enter_area",i:[12,26,66,0],s:"']$'Z$']&'Z(']*'Z~']1'Z2']2'Z0']~'Z-']+'Z)']''Z'']''Z&']&'Z&']&'Z&']&'Y%']%'W%']%'U%']%'T%']%'S%"},{n:"incorrect",i:[20,23,77,0],s:"$P0&)$$^0&)$$P0&)$&)$&)$"}]},maps:{_type:"maps",maps:[{w:32,h:32,name:"map",sheet:"samueljohnson/Other/Pixelbox/Thal_pixelbox/assets/tilesheet2",data:"!!|~%4!!|<%4!!|O%4!!|6%4!!|0%4!!|X%4!!|=%4!!|0%4!!|@%4!!|=$%!!|J$%!!|J$%!!|0%4!!|1%H|~!!|8$%!!|@%G!!|~%G!!|~$%!!|<%G!!|7$%!!|J$%!!|0%H|~!!|,%G!!|=$%!!|3%G|,!!|/%G!!|9$%!!|J$%!!|<%G!!|0%G!!|?%G!!|,%G!!|,%G!!|2%H|-$$!!|8%H|<!!|B%H|-!!|;%G!!}+%G!!| %G!!|3%G!!|?%G!!|I%G!!|I%G!!|1$<|,!!|;%H!!|~%G!!|1$<|,!!|~%W|,!!|7%H!!|/%6!!%6%W|:!!|,%H!!|4%W|5"},{w:128,h:64,name:"map2",sheet:"",data:"!!!.!!!.!!!.!!!.!!}1$<!!!.!!!.!!!.!!!.!!!.!!!.!!.Z%Z!!!.!!.~$%!!!.!!.-$%!!!.!!|g$%!!|5$%|~!!}H$%!!}L$%!!$%!!}C$%|,!!|/$%!!|,$%|,!!}I$%!!|,$%!!}9$x!!|-$x!!|3$%!!$%|,!!$%!!}5%X%G|5!!|0$%!!|~$%!!}%$x!!|~$x!!|~$x!!|/%G!!|4%G!!|-%G|?!!|k%G|~!!|~%G|;!!|-%G!!|4%G!!|-%G%X|~!!|.%G|0!!|9%G%X|-%G!!|4%G!!|-%G!!}9%G!!|-%G!!|4%G!!|-%G!!}9%G!!|-%G!!|4%G|,!!|,%G!!|>$<|P!!|D"}]},patatracker:{_type:"Patatracker album",t:8,v:0,a:[],i:{1:[{n:""}],2:[{n:""}],3:[{n:""}],4:[{n:""}],5:[{n:"",w:{t:[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,-7,-6,-5,-4,-3,-2,-1]}}],6:[{n:"",a:0,s:0,e:0,l:0,p:0,v:[1,1,1,1,0]}],7:[{n:"",l:{},p:0,c:1,o:[{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:1}]}]},s:[{n:"bgm01",a:"",i:"",b:130,l:32,s:4,g:[],h:16,o:0,e:[0,0,0,0],t:[{y:1,p:[{s:"50D150D050D150D050B150B050B150B0000000000000000000000000"}],s:[0]},{y:1,p:[{s:"10S4010S4010R4010R0000000000000000000000000"}],s:[0]},{y:2,p:[],s:[-1]},{y:3,p:[],s:[-1]},{y:6,p:[],s:[-1]},{y:0,p:[],s:[]},{y:0,p:[],s:[]},{y:0,p:[],s:[]}]}]},animations:{enx_speech:{face0:null,face1:null},thal_speech:{face0:null,face1:null},title_screen:{a:null}},backgrounds:{bg1:null,bg1b:null}},root:"assets/",img:["info_bar.png","items.png","palette.png","tilesheet.png","tilesheet2.png","tilesheet_enemies.png","tilesheet_mountain.png","tilesheet_terrain.png","tilesheet_worldmap.png","animations/enx_speech/face0.png","animations/enx_speech/face1.png","animations/thal_speech/face0.png","animations/thal_speech/face1.png","animations/title_screen/a.png","backgrounds/bg1.png","backgrounds/bg1b.png"],snd:[],settings:{name:"Thal_pixelbox",version:"2.1.0",appid:"3td9MiWmDlOvcc8G",screen:{fullscreen:!1,resizable:!1,keepAspectRatio:!1,width:256,height:256,pixelSize:{width:2,height:2}},tileSize:{width:8,height:8},palette:{name:"db16",file:"palette",colors:["#140c1c","#deeed6","#d2aa99","#346524","#4e4a4e","#757161","#8595a1","#6daa2c","#854c30","#d04648","#d27d2c","#dad45e","#442434","#30346d","#597dce","#6dc2ca"]},controls:{A2:38,L2:37,R2:39,A:87,L:65,R:68,S:32,D:83,gs1:49,gs2:50,D2:191,B2:191,B:69},touchEvent:{multiTouch:!1,disableContextMenu:!0,hideMousePointer:!1},gamepad:{analogToDpad:!1,deadZone:.5},loader:{colors:["#140C1C","#DEEED6"],custom:""}}},g=c.settings=n.settings,o=d("./assetLoader");function s(){i.resume(),document.body.removeEventListener("mousedown",s),document.body.removeEventListener("touchstart",s)}c.inherits=d("./inherits"),c.setFullScreen=function(){},i=null,r=window.AudioContext||window.webkitAudioContext,window.AudioContext=window.webkitAudioContext=function(){return i||(i=new r,document.body.addEventListener("mousedown",s),document.body.addEventListener("touchstart",s),i)};var a=d("audio-manager"),h=c.audioManager=new a(["sfx"]);h.settings.audioPath="audio/",h.settings.defaultFade=.3,h.init(),h.setVolume("sfx",1),c.sfx=function(t,e,i,r){h.playSound("sfx",t,e,i,r)},c.music=function(t,e,i,r){t?h.playLoopSound("sfx",t,e,0,0,i,r):h.stopLoopSound("sfx")};var p,u=c.btn={},l=c.btnp={},f=c.btnr={},v={},y=[],m=0;function _(){for(var t=0;t<m;t++)l[y[t]]=!1,f[y[t]]=!1}function x(t,e){var i=v[t];i&&(e&&!u[i]&&(l[i]=!0),!e&&u[i]&&(f[i]=!0),u[i]=e)}!function(){var t=g.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var e in t)v[t[e]]=e,u[e]=!1,l[e]=!1,f[e]=!1,y.push(e);m=y.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),t.repeat||x(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),x(t.keyCode,!1)}),c.chr$=function(t){return String.fromCharCode(t)},c.clamp=function(t,e,i){return Math.max(e,Math.min(i,t))},c.random=function(t,e){return void 0===e?~~(t*Math.random()):~~(t+Math.random()*(e-t))};var b=d("./Texture"),w=d("./TileMap");p=d("./webGL"),d("./Texture/webGL"),d("./TileMap/webGL"),c.webGL=p,d("./Texture/textWebGL");var S=g.tileSize.width,T=g.tileSize.height;b.setTileSize(S,T),w.setTileSize(S,T),c.texture=function(t){var e=new b(t.width,t.height);return e.clear().draw(t,0,0),e},c.tilesheet=function(t){return b.prototype.setGlobalTilesheet(t)};var A=function(){var t=g.screen,h=t.width,u=t.height,l=t.pixelSize,e=c.$screen=new b(h,u);e.canvas=p.context.canvas;var i=e.canvas,r=i.style;if(document.body.appendChild(i),t.fullscreen)if(t.keepAspectRatio){var n=function(){var t=window.innerWidth,e=window.innerHeight,i=h*l.width,r=u*l.height,n=Math.min(t/i,e/r),o=i*n,s=r*n,a=c.$screen.canvas.style;a.width=o+"px",a.height=s+"px",a.left=(t-o)/2+"px",a.top=(e-s)/2+"px"};addEventListener("resize",n),n()}else r.width=r.height="100%";else r.width=h*l.width+"px",r.height=u*l.height+"px";return e}();c.cls=function(){return A.cls()},c.sprite=function(t,e,i,r,n,o){return A.sprite(t,e,i,r,n,o)},c.draw=function(t,e,i,r,n,o){return A.draw(t,e,i,r,n,o)},c.rect=function(t,e,i,r){return A.rect(t,e,i,r)},c.rectf=function(t,e,i,r){return A.rectf(t,e,i,r)},c.camera=function(t,e){return A.setCamera(t,e)},c.pen=function(t){return A.pen(t)},c.paper=function(t){return A.paper(t)},c.locate=function(t,e){return A.locate(t,e)},c.print=function(t,e,i){return A.print(t,e,i)},c.println=function(t){return A.println(t)},c.setCharset=function(t){return A.setCharset(t)},c.getMap=w.getMap,c.rectfill=c.rectf,A.canvas.addEventListener("contextmenu",function(t){return t.preventDefault(),!1});var k=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1/60)};window.frameId=0;var R=~~(g.screen.width/2),E=~~(g.screen.width/4),M=~~(g.screen.height/2);var P=["#000","#FFF"],L=g.loader&&g.loader.colors||g.loaderColors||P;Array.isArray(L)||(L=P);var I=d("./Color");A.setPalette([(new I).fromString(L[0]),(new I).fromString(L[1])]),A.paper(0).cls().paper(1).pen(1).rect(R-E-2,M-4,2*E+4,8),p.commit(),o.preloadStaticAssets(n,function(t,f){if(A.paper(0).pen(1).cls(),t)return console.error(t),void print(t);for(var e in c.assets=f,c)window[e]=c[e];var i=c.bleeper=d("./bleeper");window.bleeper=i,f.bleeper&&i.loadProgram(f.bleeper),function(){var t=d("./Color"),e=g.palette;if(e.file){for(var i=e.file.split("/"),r=f;r&&i.length;)r=r[i.shift()];if(!r)return;var n=r.width,o=r.height,s=r.x||0,a=r.y||0;r._isSprite&&(r=r.img);var h=d("./domUtils/createCanvas")(n,o).getContext("2d");h.drawImage(r,s,a,n,o,0,0,n,o);for(var u=h.getImageData(0,0,n,o).data,l=[],c=0;c<u.length;c+=4)u[c+3]<=1||l.push((new t).fromPixel(u,c));A.setPalette(l)}else{var p;for(p=e.colors?e.colors:e,l=[],c=0;c<p.length;c++)l.push((new t).fromString(p[c]));A.setPalette(l)}}(),f.tilesheet&&c.tilesheet(f.tilesheet),w.loadBank(f.maps),f.slicesConfig&&d("./NineSlice/init")(f.slicesConfig);var r=d("./gamepad"),n=g.gamepad||{};n.analogToDpad&&r.mapAnalogStickToDpad(n.deadZone);var o=d("../../src/main.js");o.update?(p.batcher.flush(),_(),function t(){window.frameId+=1,r.update(),o.update(),_(),p.commit(),k(t)}()):function t(){p.commit(),k(t)}()},function(t,e,i,r){A.rect(R-E-2,M-4,2*E+4,8).rectf(R-E,M-2,~~(r*E*2),4),p.commit()})},{".":24,"../../src/main.js":42,"./Color":11,"./NineSlice/init":13,"./Texture":14,"./Texture/textWebGL":16,"./Texture/webGL":17,"./TileMap":18,"./TileMap/webGL":19,"./assetLoader":20,"./bleeper":21,"./domUtils/createCanvas":22,"./gamepad":23,"./inherits":25,"./webGL":31,"audio-manager":5}]},{},[44]);